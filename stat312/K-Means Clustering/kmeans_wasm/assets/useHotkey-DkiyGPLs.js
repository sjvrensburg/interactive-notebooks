import{s as q}from"./chunk-DZLz74EQ.js";import{i as G,o as R,r as C}from"./react-7g8sREeT.js";import{t as J}from"./react-BcIddLXZ.js";import{n as B}from"./jsx-runtime-DvsdsEjx.js";import{n as V,t as $}from"./Logger-BkkOJyg0.js";import{a as K,s as U}from"./hotkeys-CBY41Jr2.js";import{f as Q}from"./utils-DBmmAf_K.js";import{r as D}from"./config-DXGmIv9f.js";import{t as z}from"./useEventListener-g9rPKvBX.js";import{n as T}from"./useEvent-BOb1a9d1.js";import{t as N}from"./strings-DYBy5ejj.js";function X(){try{return window.__MARIMO_MOUNT_CONFIG__.version}catch{return $.warn("Failed to get version from mount config"),null}}var Y=X()||"latest";const Z=R(Y),ee=R(!0),re=R(null);var te={"Content-Type":"application/json"},oe=/\{[^{}]+\}/g,ne=class extends Request{constructor(t,r){for(let e in super(t,r),r)e in this||(this[e]=r[e])}};function se(t){let{baseUrl:r="",fetch:e=globalThis.fetch,querySerializer:n,bodySerializer:o,headers:s,...a}={...t};r.endsWith("/")&&(r=r.substring(0,r.length-1)),s=M(te,s);let i=[];async function c(l,u){let{fetch:p=e,headers:b,params:d={},parseAs:w="json",querySerializer:j,bodySerializer:O=o??ie,...F}=u||{},x=typeof n=="function"?n:H(n);j&&(x=typeof j=="function"?j:H({...typeof n=="object"?n:{},...j}));let m={redirect:"follow",...a,...F,headers:M(s,b,d.header)};m.body&&(m.body=O(m.body)),m.body instanceof FormData&&m.headers.delete("Content-Type");let g=new ne(le(l,{baseUrl:r,params:d,querySerializer:x}),m),P={baseUrl:r,fetch:p,parseAs:w,querySerializer:x,bodySerializer:O};for(let h of i)if(h&&typeof h=="object"&&typeof h.onRequest=="function"){g.schemaPath=l,g.params=d;let y=await h.onRequest(g,P);if(y){if(!(y instanceof Request))throw Error("Middleware must return new Request() when modifying the request");g=y}}let f=await p(g);for(let h=i.length-1;h>=0;h--){let y=i[h];if(y&&typeof y=="object"&&typeof y.onResponse=="function"){let S=await y.onResponse(f,P);if(S){if(!(S instanceof Response))throw Error("Middleware must return new Response() when modifying the response");f=S}}}if(f.status===204||f.headers.get("Content-Length")==="0")return f.ok?{data:{},response:f}:{error:{},response:f};if(f.ok)return w==="stream"?{data:f.body,response:f}:{data:await f[w](),response:f};let E=await f.text();try{E=JSON.parse(E)}catch{}return{error:E,response:f}}return{async GET(l,u){return c(l,{...u,method:"GET"})},async PUT(l,u){return c(l,{...u,method:"PUT"})},async POST(l,u){return c(l,{...u,method:"POST"})},async DELETE(l,u){return c(l,{...u,method:"DELETE"})},async OPTIONS(l,u){return c(l,{...u,method:"OPTIONS"})},async HEAD(l,u){return c(l,{...u,method:"HEAD"})},async PATCH(l,u){return c(l,{...u,method:"PATCH"})},async TRACE(l,u){return c(l,{...u,method:"TRACE"})},use(...l){for(let u of l)if(u){if(typeof u!="object"||!("onRequest"in u||"onResponse"in u))throw Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");i.push(u)}},eject(...l){for(let u of l){let p=i.indexOf(u);p!==-1&&i.splice(p,1)}}}}function v(t,r,e){if(r==null)return"";if(typeof r=="object")throw Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${(e==null?void 0:e.allowReserved)===!0?r:encodeURIComponent(r)}`}function k(t,r,e){if(!r||typeof r!="object")return"";let n=[],o={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(let i in r)n.push(i,e.allowReserved===!0?r[i]:encodeURIComponent(r[i]));let a=n.join(",");switch(e.style){case"form":return`${t}=${a}`;case"label":return`.${a}`;case"matrix":return`;${t}=${a}`;default:return a}}for(let a in r){let i=e.style==="deepObject"?`${t}[${a}]`:a;n.push(v(i,r[a],e))}let s=n.join(o);return e.style==="label"||e.style==="matrix"?`${o}${s}`:s}function I(t,r,e){if(!Array.isArray(r))return"";if(e.explode===!1){let s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",a=(e.allowReserved===!0?r:r.map(i=>encodeURIComponent(i))).join(s);switch(e.style){case"simple":return a;case"label":return`.${a}`;case"matrix":return`;${t}=${a}`;default:return`${t}=${a}`}}let n={simple:",",label:".",matrix:";"}[e.style]||"&",o=[];for(let s of r)e.style==="simple"||e.style==="label"?o.push(e.allowReserved===!0?s:encodeURIComponent(s)):o.push(v(t,s,e));return e.style==="label"||e.style==="matrix"?`${n}${o.join(n)}`:o.join(n)}function H(t){return function(r){let e=[];if(r&&typeof r=="object")for(let n in r){let o=r[n];if(o!=null){if(Array.isArray(o)){e.push(I(n,o,{style:"form",explode:!0,...t==null?void 0:t.array,allowReserved:(t==null?void 0:t.allowReserved)||!1}));continue}if(typeof o=="object"){e.push(k(n,o,{style:"deepObject",explode:!0,...t==null?void 0:t.object,allowReserved:(t==null?void 0:t.allowReserved)||!1}));continue}e.push(v(n,o,t))}}return e.join("&")}}function ae(t,r){let e=t;for(let n of t.match(oe)??[]){let o=n.substring(1,n.length-1),s=!1,a="simple";if(o.endsWith("*")&&(s=!0,o=o.substring(0,o.length-1)),o.startsWith(".")?(a="label",o=o.substring(1)):o.startsWith(";")&&(a="matrix",o=o.substring(1)),!r||r[o]===void 0||r[o]===null)continue;let i=r[o];if(Array.isArray(i)){e=e.replace(n,I(o,i,{style:a,explode:s}));continue}if(typeof i=="object"){e=e.replace(n,k(o,i,{style:a,explode:s}));continue}if(a==="matrix"){e=e.replace(n,`;${v(o,i)}`);continue}e=e.replace(n,a==="label"?`.${i}`:i)}return e}function ie(t){return JSON.stringify(t)}function le(t,r){var o;let e=`${r.baseUrl}${t}`;(o=r.params)!=null&&o.path&&(e=ae(e,r.params.path));let n=r.querySerializer(r.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(e+=`?${n}`),e}function M(...t){let r=new Headers;for(let e of t){if(!e||typeof e!="object")continue;let n=e instanceof Headers?e.entries():Object.entries(e);for(let[o,s]of n)if(s===null)r.delete(o);else if(Array.isArray(s))for(let a of s)r.append(o,a);else s!==void 0&&r.set(o,s)}return r}function ue(t){return se(t)}function W(){let t=D().httpURL;return t.search="",t.hash="",t.toString()}const A={post(t,r,e={}){let n=`${N.withTrailingSlash(e.baseUrl??W())}api${t}`;return fetch(n,{method:"POST",headers:{"Content-Type":"application/json",...A.headers(),...e.headers},body:JSON.stringify(r),signal:e.signal}).then(async o=>{var a;let s=(a=o.headers.get("Content-Type"))==null?void 0:a.startsWith("application/json");if(!o.ok){let i=s?await o.json():await o.text();throw Error(o.statusText,{cause:i})}return s?o.json():o.text()}).catch(o=>{throw $.error(`Error requesting ${n}`,o),o})},get(t,r={}){let e=`${N.withTrailingSlash(r.baseUrl??W())}api${t}`;return fetch(e,{method:"GET",headers:{...A.headers(),...r.headers}}).then(n=>{var o;if(!n.ok)throw Error(n.statusText);return(o=n.headers.get("Content-Type"))!=null&&o.startsWith("application/json")?n.json():null}).catch(n=>{throw $.error(`Error requesting ${e}`,n),n})},headers(){return D().headers()},handleResponse:t=>t.error?Promise.reject(t.error):Promise.resolve(t.data),handleResponseReturnNull:t=>t.error?Promise.reject(t.error):Promise.resolve(null)};function fe(t){let r=ue({baseUrl:t.httpURL.toString()});return r.use({onRequest:e=>{let n=t.headers();for(let[o,s]of Object.entries(n))e.headers.set(o,s);return e}}),r}var _=R({});function ce(){return C(_)}function pe(){let t=G(_);return{registerAction:T((r,e)=>{t(n=>({...n,[r]:e}))}),unregisterAction:T(r=>{t(e=>{let{[r]:n,...o}=e;return o})})}}var L=q(B()),de=q(J());function he(t,r){let e=(0,L.c)(13),{registerAction:n,unregisterAction:o}=pe(),s=C(Q),a=r===V.NOOP,i;e[0]===r?i=e[1]:(i=d=>r(d),e[0]=r,e[1]=i);let c=T(i),l;e[2]!==r||e[3]!==s||e[4]!==t?(l=d=>{let w=s.getHotkey(t).key;U(w)(d)&&r(d)!==!1&&(d.preventDefault(),d.stopPropagation())},e[2]=r,e[3]=s,e[4]=t,e[5]=l):l=e[5];let u=T(l);z(document,"keydown",u);let p,b;e[6]!==a||e[7]!==c||e[8]!==n||e[9]!==t||e[10]!==o?(p=()=>{if(!a)return n(t,c),()=>o(t)},b=[c,t,a,n,o],e[6]=a,e[7]=c,e[8]=n,e[9]=t,e[10]=o,e[11]=p,e[12]=b):(p=e[11],b=e[12]),(0,de.useEffect)(p,b)}function ye(t,r){let e=(0,L.c)(2),n;e[0]===r?n=e[1]:(n=o=>{for(let[s,a]of K.entries(r))U(s)(o)&&($.debug("Satisfied",s,o),a(o)!==!1&&(o.preventDefault(),o.stopPropagation()))},e[0]=r,e[1]=n),z(t,"keydown",n)}export{fe as a,ee as c,A as i,ye as n,Z as o,ce as r,re as s,he as t};
