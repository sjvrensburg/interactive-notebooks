var Tn=Object.defineProperty;var Cn=(t,e,a)=>e in t?Tn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var W=(t,e,a)=>Cn(t,typeof e!="symbol"?e+"":e,a);import{s as et,t as En}from"./chunk-DZLz74EQ.js";import{a as Cr,n as In,r as Sn}from"./react-7g8sREeT.js";import{t as An}from"./react-BcIddLXZ.js";import{$t as ba,Ar as On,Bt as Rn,E as Nn,Jn as Mn,Ot as Pn,Rt as jn,Sr as Er,St as Zn,Vt as xa,_t as $n,a as Ln,cn as Ir,dr as Dn,jr as Fn,o as zn,tt as Un,ut as Vn,vn as Bn,vt as Wn,wr as qn,x as Kn,yr as Jn,zr as Yn}from"./cells-Dd1FatlG.js";import{A as T,D as Hn,E as re,F as S,G as Sr,H as te,I as de,L as wa,N as Ie,O as Gn,P as It,R as G,S as Qn,T as Ar,U as Xn,V as ue,Y as Or,b as ka,j as yt,k as ei,w as Be,x as Vt,z as h}from"./zod-BEi78Y5d.js";import{n as Ta,t as ti}from"./jsx-runtime-DvsdsEjx.js";import{r as Rr}from"./invariant-91cSKJcr.js";import{t as ce}from"./Logger-BkkOJyg0.js";import{o as ai}from"./hotkeys-CBY41Jr2.js";import{a as ri}from"./config-DXGmIv9f.js";import{t as Nr}from"./cn-Dr9kMPPj.js";import{t as tt}from"./button-Bxk0BtBn.js";import{Ft as si,Gt as ni,Ht as Bt,It as ii,Q as Ca,Rt as oi,Ut as Wt,_t as Ea,et as Mr,gt as li,it as Pr,rt as di}from"./dist-CoL9j4yJ.js";import{t as ui}from"./createReducer-CFr1RdS2.js";import{a as ci,r as pi}from"./key-D4QiH_7H.js";import{h as mi,o as hi,r as fi}from"./dist-Bz53xjA5.js";import{i as gi}from"./dist-CyqTsfyg.js";import{t as jr}from"./use-toast-D6NNsC80.js";import{r as yi}from"./useTheme-oPMxEKRc.js";import{t as Zr}from"./createLucideIcon-QLW8E4z5.js";import{l as vi,t as _i}from"./ai-model-dropdown-DSUVFIso.js";import{h as bi}from"./select-DKRTzlUU.js";import{c as xi,n as wi,u as ki}from"./ansi_up-D_b0GS7N.js";import{a as $r,c as Ti,p as Ci,r as Ei,t as Ii}from"./dropdown-menu-CJDB1PNI.js";import{n as Si}from"./spinner-BhnfQOEl.js";import{i as Ai,t as Oi}from"./useDeleteCell-CJaipocw.js";import{r as Ri}from"./useNonce-BbWkd3B4.js";import{t as Ni}from"./shim-CWt9rDBn.js";import{n as Mi}from"./useEvent-BOb1a9d1.js";import{n as Pi}from"./errors-_3XAtRr3.js";import{n as Lr}from"./renderShortcut-C9_NT6sD.js";import{t as ji}from"./es-BVCqnQhJ.js";import{n as Zi}from"./dom-CT3dAMQW.js";import{t as $i}from"./blob-CTPcPiam.js";import{r as Li,t as Di}from"./esm-7XxuulnL.js";import{n as Fi}from"./add-missing-import-CfRgNApn.js";import{n as zi}from"./icons-CLD-J5J3.js";var Ui=Zr("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),Vi=Zr("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),Dr="vercel.ai.error",Bi=Symbol.for(Dr),Fr,Wi=class gn extends Error{constructor({name:e,message:a,cause:r}){super(a),this[Fr]=!0,this.name=e,this.cause=r}static isInstance(e){return gn.hasMarker(e,Dr)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Fr=Bi;var at=Wi;function zr(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Ur="AI_InvalidArgumentError",Vr=`vercel.ai.error.${Ur}`,qi=Symbol.for(Vr),Br,Ki=class extends at{constructor({message:t,cause:e,argument:a}){super({name:Ur,message:t,cause:e}),this[Br]=!0,this.argument=a}static isInstance(t){return at.hasMarker(t,Vr)}};Br=qi;var Wr="AI_JSONParseError",qr=`vercel.ai.error.${Wr}`,Ji=Symbol.for(qr),Kr,Jr=class extends at{constructor({text:t,cause:e}){super({name:Wr,message:`JSON parsing failed: Text: ${t}.
Error message: ${zr(e)}`,cause:e}),this[Kr]=!0,this.text=t}static isInstance(t){return at.hasMarker(t,qr)}};Kr=Ji;var Yr="AI_TypeValidationError",Hr=`vercel.ai.error.${Yr}`,Yi=Symbol.for(Hr),Gr,Hi=class _r extends at{constructor({value:e,cause:a}){super({name:Yr,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${zr(a)}`,cause:a}),this[Gr]=!0,this.value=e}static isInstance(e){return at.hasMarker(e,Hr)}static wrap({value:e,cause:a}){return _r.isInstance(a)&&a.value===e?a:new _r({value:e,cause:a})}};Gr=Yi;var qt=Hi,Qr=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function Ia(t){}function Gi(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=Ia,onError:a=Ia,onRetry:r=Ia,onComment:s}=t,n="",i=!0,o,l="",d="";function u(f){let c=i?f.replace(/^\xEF\xBB\xBF/,""):f,[m,b]=Qi(`${n}${c}`);for(let C of m)p(C);n=b,i=!1}function p(f){if(f===""){y();return}if(f.startsWith(":")){s&&s(f.slice(f.startsWith(": ")?2:1));return}let c=f.indexOf(":");if(c!==-1){let m=f.slice(0,c),b=f[c+1]===" "?2:1,C=f.slice(c+b);_(m,C,f);return}_(f,"",f)}function _(f,c,m){switch(f){case"event":d=c;break;case"data":l=`${l}${c}
`;break;case"id":o=c.includes("\0")?void 0:c;break;case"retry":/^\d+$/.test(c)?r(parseInt(c,10)):a(new Qr(`Invalid \`retry\` value: "${c}"`,{type:"invalid-retry",value:c,line:m}));break;default:a(new Qr(`Unknown field "${f.length>20?`${f.slice(0,20)}\u2026`:f}"`,{type:"unknown-field",field:f,value:c,line:m}));break}}function y(){l.length>0&&e({id:o,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",d=""}function x(f={}){n&&f.consume&&p(n),i=!0,o=void 0,l="",d="",n=""}return{feed:u,reset:x}}function Qi(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),i=-1;if(s!==-1&&n!==-1?i=Math.min(s,n):s===-1?n!==-1&&(i=n):i=s===t.length-1?-1:s,i===-1){a=t.slice(r);break}else{let o=t.slice(r,i);e.push(o),r=i+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var Xi=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=Gi({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},z;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let i of s)n[i]=i;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of n)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.push(i);return n},t.find=(s,n)=>{for(let i of s)if(n(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(z||(z={}));var eo;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(eo||(eo={}));const k=z.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),rt=t=>{switch(typeof t){case"undefined":return k.undefined;case"string":return k.string;case"number":return Number.isNaN(t)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(t)?k.array:t===null?k.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?k.promise:typeof Map<"u"&&t instanceof Map?k.map:typeof Set<"u"&&t instanceof Set?k.set:typeof Date<"u"&&t instanceof Date?k.date:k.object;default:return k.unknown}},g=z.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var $e=class yn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let i of n.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(a(i));else{let o=r,l=0;for(;l<i.path.length;){let d=i.path[l];l===i.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(a(i))):o[d]=o[d]||{_errors:[]},o=o[d],l++}}};return s(this),r}static assert(e){if(!(e instanceof yn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,z.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a={},r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};$e.create=t=>new $e(t);var St=(t,e)=>{let a;switch(t.code){case g.invalid_type:a=t.received===k.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case g.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,z.jsonStringifyReplacer)}`;break;case g.unrecognized_keys:a=`Unrecognized key(s) in object: ${z.joinValues(t.keys,", ")}`;break;case g.invalid_union:a="Invalid input";break;case g.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${z.joinValues(t.options)}`;break;case g.invalid_enum_value:a=`Invalid enum value. Expected ${z.joinValues(t.options)}, received '${t.received}'`;break;case g.invalid_arguments:a="Invalid function arguments";break;case g.invalid_return_type:a="Invalid function return type";break;case g.invalid_date:a="Invalid date";break;case g.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:z.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case g.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case g.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case g.custom:a="Invalid input";break;case g.invalid_intersection_types:a="Intersection results could not be merged";break;case g.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case g.not_finite:a="Number must be finite";break;default:a=e.defaultError,z.assertNever(t)}return{message:a}},to=St;function Sa(){return to}const Aa=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],i={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let o="",l=r.filter(d=>!!d).slice().reverse();for(let d of l)o=d(i,{data:e,defaultError:o}).message;return{...s,path:n,message:o}};function w(t,e){let a=Sa(),r=Aa({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===St?void 0:St].filter(s=>!!s)});t.common.issues.push(r)}var we=class vn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return O;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,i=await s.value;r.push({key:n,value:i})}return vn.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:i}=s;if(n.status==="aborted"||i.status==="aborted")return O;n.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(i.value!==void 0||s.alwaysSet)&&(r[n.value]=i.value)}return{status:e.value,value:r}}};const O=Object.freeze({status:"aborted"}),Oa=t=>({status:"dirty",value:t}),ye=t=>({status:"valid",value:t}),Xr=t=>t.status==="aborted",es=t=>t.status==="dirty",vt=t=>t.status==="valid",Kt=t=>typeof Promise<"u"&&t instanceof Promise;var E;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(E||(E={}));var Le=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},ts=(t,e)=>{if(vt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new $e(t.common.issues)),this._error}}};function M(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,i)=>{let{message:o}=t;return n.code==="invalid_enum_value"?{message:o??i.defaultError}:i.data===void 0?{message:o??r??i.defaultError}:n.code==="invalid_type"?{message:o??a??i.defaultError}:{message:i.defaultError}},description:s}}var Z=class{get description(){return this._def.description}_getType(t){return rt(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:rt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new we,ctx:{common:t.parent.common,data:t.data,parsedType:rt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(Kt(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:rt(t)},r=this._parseSync({data:t,path:a.path,parent:a});return ts(a,r)}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:rt(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return vt(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>vt(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:rt(t)},r=this._parse({data:t,path:a.path,parent:a}),s=await(Kt(r)?r:Promise.resolve(r));return ts(a,s)}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),i=()=>s.addIssue({code:g.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(o=>o?!0:(i(),!1)):n?!0:(i(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new We({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return qe.create(this,this._def)}nullable(){return ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return bt.create(this)}promise(){return At.create(this,this._def)}or(t){return Gt.create([this,t],this._def)}and(t){return Qt.create(this,t,this._def)}transform(t){return new We({...M(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new ra({...M(this._def),innerType:this,defaultValue:e,typeName:v.ZodDefault})}brand(){return new is({typeName:v.ZodBranded,type:this,...M(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new sa({...M(this._def),innerType:this,catchValue:e,typeName:v.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return os.create(this,t)}readonly(){return na.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},ao=/^c[^\s-]{8,}$/i,ro=/^[0-9a-z]+$/,so=/^[0-9A-HJKMNP-TV-Z]{26}$/i,no=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,io=/^[a-z0-9_-]{21}$/i,oo=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,lo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,uo=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,co="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",as,po=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,mo=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ho=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,fo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,go=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yo=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,rs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",vo=RegExp(`^${rs}$`);function ss(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function _o(t){return RegExp(`^${ss(t)}$`)}function bo(t){let e=`${rs}T${ss(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function xo(t,e){return!!((e==="v4"||!e)&&po.test(t)||(e==="v6"||!e)&&ho.test(t))}function wo(t,e){if(!oo.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function ko(t,e){return!!((e==="v4"||!e)&&mo.test(t)||(e==="v6"||!e)&&fo.test(t))}var Jt=class zt extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.string,received:s.parsedType}),O}let a=new we,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?w(r,{code:g.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&w(r,{code:g.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")uo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"email",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")as||(as=new RegExp(co,"u")),as.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"emoji",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")no.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"uuid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")io.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"nanoid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")ao.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")ro.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid2",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")so.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ulid",code:g.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),w(r,{validation:"url",code:g.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"regex",code:g.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?bo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?vo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?_o(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:g.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?lo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"duration",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?xo(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ip",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?wo(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"jwt",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?ko(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cidr",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?go.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64",code:g.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?yo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64url",code:g.invalid_string,message:s.message}),a.dirty()):z.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:g.invalid_string,...E.errToObj(r)})}_addCheck(e){return new zt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...E.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...E.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...E.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...E.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...E.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...E.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...E.errToObj(a)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new zt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Jt.create=t=>new Jt({checks:[],typeName:v.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...M(t)});function To(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r,n=Number.parseInt(t.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return n%i/10**s}var Ra=class br extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.number,received:s.parsedType}),O}let a,r=new we;for(let s of this._def.checks)s.kind==="int"?z.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:g.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?To(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_finite,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,E.toString(a))}gt(e,a){return this.setLimit("min",e,!1,E.toString(a))}lte(e,a){return this.setLimit("max",e,!0,E.toString(a))}lt(e,a){return this.setLimit("max",e,!1,E.toString(a))}setLimit(e,a,r,s){return new br({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:E.toString(s)}]})}_addCheck(e){return new br({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:E.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&z.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};Ra.create=t=>new Ra({checks:[],typeName:v.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...M(t)});var Na=class xr extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let a,r=new we;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),w(a,{code:g.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return w(a,{code:g.invalid_type,expected:k.bigint,received:a.parsedType}),O}gte(e,a){return this.setLimit("min",e,!0,E.toString(a))}gt(e,a){return this.setLimit("min",e,!1,E.toString(a))}lte(e,a){return this.setLimit("max",e,!0,E.toString(a))}lt(e,a){return this.setLimit("max",e,!1,E.toString(a))}setLimit(e,a,r,s){return new xr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:E.toString(s)}]})}_addCheck(e){return new xr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Na.create=t=>new Na({checks:[],typeName:v.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...M(t)});var Ma=class extends Z{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==k.boolean){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.boolean,received:e.parsedType}),O}return ye(t.data)}};Ma.create=t=>new Ma({typeName:v.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...M(t)});var Pa=class _n extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_type,expected:k.date,received:s.parsedType}),O}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return w(s,{code:g.invalid_date}),O}let a=new we,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:g.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):z.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new _n({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};Pa.create=t=>new Pa({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:v.ZodDate,...M(t)});var ja=class extends Z{_parse(t){if(this._getType(t)!==k.symbol){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.symbol,received:e.parsedType}),O}return ye(t.data)}};ja.create=t=>new ja({typeName:v.ZodSymbol,...M(t)});var Yt=class extends Z{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.undefined,received:e.parsedType}),O}return ye(t.data)}};Yt.create=t=>new Yt({typeName:v.ZodUndefined,...M(t)});var Ht=class extends Z{_parse(t){if(this._getType(t)!==k.null){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.null,received:e.parsedType}),O}return ye(t.data)}};Ht.create=t=>new Ht({typeName:v.ZodNull,...M(t)});var Za=class extends Z{constructor(){super(...arguments),this._any=!0}_parse(t){return ye(t.data)}};Za.create=t=>new Za({typeName:v.ZodAny,...M(t)});var _t=class extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ye(t.data)}};_t.create=t=>new _t({typeName:v.ZodUnknown,...M(t)});var st=class extends Z{_parse(t){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.never,received:e.parsedType}),O}};st.create=t=>new st({typeName:v.ZodNever,...M(t)});var $a=class extends Z{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.void,received:e.parsedType}),O}return ye(t.data)}};$a.create=t=>new $a({typeName:v.ZodVoid,...M(t)});var bt=class va extends Z{_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==k.array)return w(a,{code:g.invalid_type,expected:k.array,received:a.parsedType}),O;if(s.exactLength!==null){let i=a.data.length>s.exactLength.value,o=a.data.length<s.exactLength.value;(i||o)&&(w(a,{code:i?g.too_big:g.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(w(a,{code:g.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(w(a,{code:g.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((i,o)=>s.type._parseAsync(new Le(a,i,a.path,o)))).then(i=>we.mergeArray(r,i));let n=[...a.data].map((i,o)=>s.type._parseSync(new Le(a,i,a.path,o)));return we.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new va({...this._def,minLength:{value:e,message:E.toString(a)}})}max(e,a){return new va({...this._def,maxLength:{value:e,message:E.toString(a)}})}length(e,a){return new va({...this._def,exactLength:{value:e,message:E.toString(a)}})}nonempty(e){return this.min(1,e)}};bt.create=(t,e)=>new bt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...M(e)});function xt(t){if(t instanceof Re){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=qe.create(xt(r))}return new Re({...t._def,shape:()=>e})}else return t instanceof bt?new bt({...t._def,type:xt(t.element)}):t instanceof qe?qe.create(xt(t.unwrap())):t instanceof ct?ct.create(xt(t.unwrap())):t instanceof ut?ut.create(t.items.map(e=>xt(e))):t}var Re=class je extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),a=z.objectKeys(e);return this._cached={shape:e,keys:a},this._cached}_parse(e){if(this._getType(e)!==k.object){let l=this._getOrReturnCtx(e);return w(l,{code:g.invalid_type,expected:k.object,received:l.parsedType}),O}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof st&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||i.push(l);let o=[];for(let l of n){let d=s[l],u=r.data[l];o.push({key:{status:"valid",value:l},value:d._parse(new Le(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof st){let l=this._def.unknownKeys;if(l==="passthrough")for(let d of i)o.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(l==="strict")i.length>0&&(w(r,{code:g.unrecognized_keys,keys:i}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let d of i){let u=r.data[d];o.push({key:{status:"valid",value:d},value:l._parse(new Le(r,u,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let d of o){let u=await d.key,p=await d.value;l.push({key:u,value:p,alwaysSet:d.alwaysSet})}return l}).then(l=>we.mergeObjectSync(a,l)):we.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new je({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,i;let s=((i=(n=this._def).errorMap)==null?void 0:i.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:E.errToObj(e).message??s}:{message:s}}}})}strip(){return new je({...this._def,unknownKeys:"strip"})}passthrough(){return new je({...this._def,unknownKeys:"passthrough"})}extend(e){return new je({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new je({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new je({...this._def,catchall:e})}pick(e){let a={};for(let r of z.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new je({...this._def,shape:()=>a})}omit(e){let a={};for(let r of z.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new je({...this._def,shape:()=>a})}deepPartial(){return xt(this)}partial(e){let a={};for(let r of z.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new je({...this._def,shape:()=>a})}required(e){let a={};for(let r of z.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof qe;)s=s._def.innerType;a[r]=s}return new je({...this._def,shape:()=>a})}keyof(){return ns(z.objectKeys(this.shape))}};Re.create=(t,e)=>new Re({shape:()=>t,unknownKeys:"strip",catchall:st.create(),typeName:v.ZodObject,...M(e)}),Re.strictCreate=(t,e)=>new Re({shape:()=>t,unknownKeys:"strict",catchall:st.create(),typeName:v.ZodObject,...M(e)}),Re.lazycreate=(t,e)=>new Re({shape:t,unknownKeys:"strip",catchall:st.create(),typeName:v.ZodObject,...M(e)});var Gt=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let i of s)if(i.result.status==="valid")return i.result;for(let i of s)if(i.result.status==="dirty")return e.common.issues.push(...i.ctx.common.issues),i.result;let n=s.map(i=>new $e(i.ctx.common.issues));return w(e,{code:g.invalid_union,unionErrors:n}),O}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let o of a){let l={...e,common:{...e.common,issues:[]},parent:null},d=o._parseSync({data:e.data,path:e.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let i=n.map(o=>new $e(o));return w(e,{code:g.invalid_union,unionErrors:i}),O}}get options(){return this._def.options}};Gt.create=(t,e)=>new Gt({options:t,typeName:v.ZodUnion,...M(e)});var nt=t=>t instanceof Xt?nt(t.schema):t instanceof We?nt(t.innerType()):t instanceof ea?[t.value]:t instanceof ta?t.options:t instanceof aa?z.objectValues(t.enum):t instanceof ra?nt(t._def.innerType):t instanceof Yt?[void 0]:t instanceof Ht?[null]:t instanceof qe?[void 0,...nt(t.unwrap())]:t instanceof ct?[null,...nt(t.unwrap())]:t instanceof is||t instanceof na?nt(t.unwrap()):t instanceof sa?nt(t._def.innerType):[],Co=class bn extends Z{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.object)return w(a,{code:g.invalid_type,expected:k.object,received:a.parsedType}),O;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(w(a,{code:g.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),O)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let i=nt(n.shape[e]);if(!i.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,n)}}return new bn({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...M(r)})}};function La(t,e){let a=rt(t),r=rt(e);if(t===e)return{valid:!0,data:t};if(a===k.object&&r===k.object){let s=z.objectKeys(e),n=z.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(let o of n){let l=La(t[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(a===k.array&&r===k.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let i=t[n],o=e[n],l=La(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===k.date&&r===k.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Qt=class extends Z{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(Xr(s)||Xr(n))return O;let i=La(s.value,n.value);return i.valid?((es(s)||es(n))&&e.dirty(),{status:e.value,value:i.data}):(w(a,{code:g.invalid_intersection_types}),O)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};Qt.create=(t,e,a)=>new Qt({left:t,right:e,typeName:v.ZodIntersection,...M(a)});var ut=class xn extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.array)return w(r,{code:g.invalid_type,expected:k.array,received:r.parsedType}),O;if(r.data.length<this._def.items.length)return w(r,{code:g.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&r.data.length>this._def.items.length&&(w(r,{code:g.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,i)=>{let o=this._def.items[i]||this._def.rest;return o?o._parse(new Le(r,n,r.path,i)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>we.mergeArray(a,n)):we.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new xn({...this._def,rest:e})}};ut.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ut({items:t,typeName:v.ZodTuple,rest:null,...M(e)})};var Eo=class wr extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.object)return w(r,{code:g.invalid_type,expected:k.object,received:r.parsedType}),O;let s=[],n=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:n._parse(new Le(r,o,r.path,o)),value:i._parse(new Le(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?we.mergeObjectAsync(a,s):we.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof Z?new wr({keyType:e,valueType:a,typeName:v.ZodRecord,...M(r)}):new wr({keyType:Jt.create(),valueType:e,typeName:v.ZodRecord,...M(a)})}},Da=class extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==k.map)return w(a,{code:g.invalid_type,expected:k.map,received:a.parsedType}),O;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([i,o],l)=>({key:r._parse(new Le(a,i,a.path,[l,"key"])),value:s._parse(new Le(a,o,a.path,[l,"value"]))}));if(a.common.async){let i=new Map;return Promise.resolve().then(async()=>{for(let o of n){let l=await o.key,d=await o.value;if(l.status==="aborted"||d.status==="aborted")return O;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),i.set(l.value,d.value)}return{status:e.value,value:i}})}else{let i=new Map;for(let o of n){let l=o.key,d=o.value;if(l.status==="aborted"||d.status==="aborted")return O;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),i.set(l.value,d.value)}return{status:e.value,value:i}}}};Da.create=(t,e,a)=>new Da({valueType:e,keyType:t,typeName:v.ZodMap,...M(a)});var Fa=class kr extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.set)return w(r,{code:g.invalid_type,expected:k.set,received:r.parsedType}),O;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(w(r,{code:g.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(w(r,{code:g.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function i(l){let d=new Set;for(let u of l){if(u.status==="aborted")return O;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let o=[...r.data.values()].map((l,d)=>n._parse(new Le(r,l,r.path,d)));return r.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,a){return new kr({...this._def,minSize:{value:e,message:E.toString(a)}})}max(e,a){return new kr({...this._def,maxSize:{value:e,message:E.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};Fa.create=(t,e)=>new Fa({valueType:t,minSize:null,maxSize:null,typeName:v.ZodSet,...M(e)});var Io=class _a extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.function)return w(a,{code:g.invalid_type,expected:k.function,received:a.parsedType}),O;function r(o,l){return Aa({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Sa(),St].filter(d=>!!d),issueData:{code:g.invalid_arguments,argumentsError:l}})}function s(o,l){return Aa({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Sa(),St].filter(d=>!!d),issueData:{code:g.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},i=a.data;if(this._def.returns instanceof At){let o=this;return ye(async function(...l){let d=new $e([]),u=await o._def.args.parseAsync(l,n).catch(_=>{throw d.addIssue(r(l,_)),d}),p=await Reflect.apply(i,this,u);return await o._def.returns._def.type.parseAsync(p,n).catch(_=>{throw d.addIssue(s(p,_)),d})})}else{let o=this;return ye(function(...l){let d=o._def.args.safeParse(l,n);if(!d.success)throw new $e([r(l,d.error)]);let u=Reflect.apply(i,this,d.data),p=o._def.returns.safeParse(u,n);if(!p.success)throw new $e([s(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new _a({...this._def,args:ut.create(e).rest(_t.create())})}returns(e){return new _a({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new _a({args:e||ut.create([]).rest(_t.create()),returns:a||_t.create(),typeName:v.ZodFunction,...M(r)})}},Xt=class extends Z{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};Xt.create=(t,e)=>new Xt({getter:t,typeName:v.ZodLazy,...M(e)});var ea=class extends Z{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return w(e,{received:e.data,code:g.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:t.data}}get value(){return this._def.value}};ea.create=(t,e)=>new ea({value:t,typeName:v.ZodLiteral,...M(e)});function ns(t,e){return new ta({values:t,typeName:v.ZodEnum,...M(e)})}var ta=class Tr extends Z{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{expected:z.joinValues(r),received:a.parsedType,code:g.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{received:a.data,code:g.invalid_enum_value,options:r}),O}return ye(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return Tr.create(e,{...this._def,...a})}exclude(e,a=this._def){return Tr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};ta.create=ns;var aa=class extends Z{_parse(t){let e=z.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==k.string&&a.parsedType!==k.number){let r=z.objectValues(e);return w(a,{expected:z.joinValues(r),received:a.parsedType,code:g.invalid_type}),O}if(this._cache||(this._cache=new Set(z.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=z.objectValues(e);return w(a,{received:a.data,code:g.invalid_enum_value,options:r}),O}return ye(t.data)}get enum(){return this._def.values}};aa.create=(t,e)=>new aa({values:t,typeName:v.ZodNativeEnum,...M(e)});var At=class extends Z{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==k.promise&&e.common.async===!1)return w(e,{code:g.invalid_type,expected:k.promise,received:e.parsedType}),O;let a=e.parsedType===k.promise?e.data:Promise.resolve(e.data);return ye(a.then(r=>this._def.type.parseAsync(r,{path:e.path,errorMap:e.common.contextualErrorMap})))}};At.create=(t,e)=>new At({type:t,typeName:v.ZodPromise,...M(e)});var We=class extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{w(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async i=>{if(e.value==="aborted")return O;let o=await this._def.schema._parseAsync({data:i,path:a.path,parent:a});return o.status==="aborted"?O:o.status==="dirty"||e.value==="dirty"?Oa(o.value):o});{if(e.value==="aborted")return O;let i=this._def.schema._parseSync({data:n,path:a.path,parent:a});return i.status==="aborted"?O:i.status==="dirty"||e.value==="dirty"?Oa(i.value):i}}if(r.type==="refinement"){let n=i=>{let o=r.refinement(i,s);if(a.common.async)return Promise.resolve(o);if(o instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?O:(i.status==="dirty"&&e.dirty(),n(i.value),{status:e.value,value:i.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>i.status==="aborted"?O:(i.status==="dirty"&&e.dirty(),n(i.value).then(()=>({status:e.value,value:i.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!vt(n))return O;let i=r.transform(n.value,s);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:i}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>vt(n)?Promise.resolve(r.transform(n.value,s)).then(i=>({status:e.value,value:i})):O);z.assertNever(r)}};We.create=(t,e,a)=>new We({schema:t,typeName:v.ZodEffects,effect:e,...M(a)}),We.createWithPreprocess=(t,e,a)=>new We({schema:e,effect:{type:"preprocess",transform:t},typeName:v.ZodEffects,...M(a)});var qe=class extends Z{_parse(t){return this._getType(t)===k.undefined?ye(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};qe.create=(t,e)=>new qe({innerType:t,typeName:v.ZodOptional,...M(e)});var ct=class extends Z{_parse(t){return this._getType(t)===k.null?ye(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:v.ZodNullable,...M(e)});var ra=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===k.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};ra.create=(t,e)=>new ra({innerType:t,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...M(e)});var sa=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return Kt(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new $e(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new $e(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};sa.create=(t,e)=>new sa({innerType:t,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...M(e)});var za=class extends Z{_parse(t){if(this._getType(t)!==k.nan){let e=this._getOrReturnCtx(t);return w(e,{code:g.invalid_type,expected:k.nan,received:e.parsedType}),O}return{status:"valid",value:t.data}}};za.create=t=>new za({typeName:v.ZodNaN,...M(t)});var is=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},os=class wn extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),Oa(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new wn({in:e,out:a,typeName:v.ZodPipeline})}},na=class extends Z{_parse(t){let e=this._def.innerType._parse(t),a=r=>(vt(r)&&(r.value=Object.freeze(r.value)),r);return Kt(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};na.create=(t,e)=>new na({innerType:t,typeName:v.ZodReadonly,...M(e)}),Re.lazycreate;var v;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(v||(v={})),Jt.create,Ra.create,za.create,Na.create,Ma.create,Pa.create,ja.create,Yt.create,Ht.create,Za.create,_t.create,st.create,$a.create,bt.create,Re.create,Re.strictCreate,Gt.create,Co.create,Qt.create,ut.create,Eo.create,Da.create,Fa.create,Io.create,Xt.create,ea.create,ta.create,aa.create,At.create,We.create,qe.create,ct.create,We.createWithPreprocess,os.create;var Ot=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,i=Array(e);for(let o=0;o<e;o++)i[o]=a[Math.random()*n|0];return i.join("")};if(t==null)return s;if(a.includes(r))throw new Ki({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},So=Ot(),Ao=/"__proto__"\s*:/,Oo=/"constructor"\s*:/;function Ro(t){let e=JSON.parse(t);return typeof e!="object"||!e||Ao.test(t)===!1&&Oo.test(t)===!1?e:No(e)}function No(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function Mo(t){let{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return Ro(t)}finally{Error.stackTraceLimit=e}}var ia=Symbol.for("vercel.ai.validator");function Po(t){return{[ia]:!0,validate:t}}function jo(t){return typeof t=="object"&&!!t&&ia in t&&t[ia]===!0&&"validate"in t}function Zo(t){return jo(t)?t:$o(t)}function $o(t){return Po(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new qt({value:e,cause:a.issues})}})}async function ls({value:t,schema:e}){let a=await Ua({value:t,schema:e});if(!a.success)throw qt.wrap({value:t,cause:a.error});return a.value}async function Ua({value:t,schema:e}){let a=Zo(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:qt.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:qt.wrap({value:t,cause:r}),rawValue:t}}}async function oa({text:t,schema:e}){try{let a=Mo(t);return e==null?{success:!0,value:a,rawValue:a}:await Ua({value:a,schema:e})}catch(a){return{success:!1,error:Jr.isInstance(a)?a:new Jr({text:t,cause:a}),rawValue:void 0}}}function ds({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new Xi).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await oa({text:a,schema:e}))}}))}async function wt(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var Lo=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},Do=Symbol("Let zodToJsonSchema decide on which parser to use"),us={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Fo=t=>typeof t=="string"?{...us,name:t}:{...us,...t};function ke(){return{}}function zo(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==v.ZodAny&&(a.items=K(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function Uo(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Vo(){return{type:"boolean"}}function cs(t,e){return K(t.type._def,e)}var Bo=(t,e)=>K(t.innerType._def,e);function ps(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>ps(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Wo(t)}}var Wo=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function qo(t,e){return{...K(t.innerType._def,e),default:t.defaultValue()}}function Ko(t,e){return e.effectStrategy==="input"?K(t.schema._def,e):ke()}function Jo(t){return{type:"string",enum:Array.from(t.values)}}var Yo=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Ho(t,e){let a=[K(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),K(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(Yo(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:i,...o}=s;n=o}r.push(n)}}),r.length?{allOf:r}:void 0}function Go(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Va=void 0,Ne={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Va===void 0&&(Va=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Va),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function ms(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Me(a,"email",r.message,e);break;case"format:idn-email":Me(a,"idn-email",r.message,e);break;case"pattern:zod":fe(a,Ne.email,r.message,e);break}break;case"url":Me(a,"uri",r.message,e);break;case"uuid":Me(a,"uuid",r.message,e);break;case"regex":fe(a,r.regex,r.message,e);break;case"cuid":fe(a,Ne.cuid,r.message,e);break;case"cuid2":fe(a,Ne.cuid2,r.message,e);break;case"startsWith":fe(a,RegExp(`^${Ba(r.value,e)}`),r.message,e);break;case"endsWith":fe(a,RegExp(`${Ba(r.value,e)}$`),r.message,e);break;case"datetime":Me(a,"date-time",r.message,e);break;case"date":Me(a,"date",r.message,e);break;case"time":Me(a,"time",r.message,e);break;case"duration":Me(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":fe(a,RegExp(Ba(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Me(a,"ipv4",r.message,e),r.version!=="v4"&&Me(a,"ipv6",r.message,e);break;case"base64url":fe(a,Ne.base64url,r.message,e);break;case"jwt":fe(a,Ne.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&fe(a,Ne.ipv4Cidr,r.message,e),r.version!=="v4"&&fe(a,Ne.ipv6Cidr,r.message,e);break;case"emoji":fe(a,Ne.emoji(),r.message,e);break;case"ulid":fe(a,Ne.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Me(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":fe(a,Ne.base64,r.message,e);break}break;case"nanoid":fe(a,Ne.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function Ba(t,e){return e.patternStrategy==="escape"?Xo(t):t}var Qo=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Xo(t){let e="";for(let a=0;a<t.length;a++)Qo.has(t[a])||(e+="\\"),e+=t[a];return e}function Me(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function fe(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:hs(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=hs(e,r)}function hs(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,i=!1,o=!1;for(let d=0;d<r.length;d++){if(n){s+=r[d],n=!1;continue}if(a.i){if(i){if(r[d].match(/[a-z]/)){o?(s+=r[d],s+=`${r[d-2]}-${r[d]}`.toUpperCase(),o=!1):r[d+1]==="-"&&((l=r[d+2])!=null&&l.match(/[a-z]/))?(s+=r[d],o=!0):s+=`${r[d]}${r[d].toUpperCase()}`;continue}}else if(r[d].match(/[a-z]/)){s+=`[${r[d]}${r[d].toUpperCase()}]`;continue}}if(a.m){if(r[d]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[d]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[d]==="."){s+=i?`${r[d]}\r
`:`[${r[d]}\r
]`;continue}s+=r[d],r[d]==="\\"?n=!0:i&&r[d]==="]"?i=!1:!i&&r[d]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function fs(t,e){var r,s,n,i,o;let a={type:"object",additionalProperties:K(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===v.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...d}=ms(t.keyType._def,e);return{...a,propertyNames:d}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===v.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((i=t.keyType)==null?void 0:i._def.typeName)===v.ZodBranded&&t.keyType._def.type._def.typeName===v.ZodString&&((o=t.keyType._def.type._def.checks)!=null&&o.length)){let{type:l,...d}=cs(t.keyType._def,e);return{...a,propertyNames:d}}}return a}function el(t,e){if(e.mapStrategy==="record")return fs(t,e);let a=K(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ke(),r=K(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ke();return{type:"array",maxItems:125,items:{type:"array",items:[a,r],minItems:2,maxItems:2}}}function tl(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function al(){return{not:ke()}}function rl(){return{type:"null"}}var Wa={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function sl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in Wa&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let i=Wa[n._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let i=typeof n._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,i,o)=>o.indexOf(n)===i);return{type:s.length>1?s:s[0],enum:a.reduce((n,i)=>n.includes(i._def.value)?n:[...n,i._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return nl(t,e)}var nl=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>K(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function il(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[Wa[t.innerType._def.typeName],"null"]};let a=K(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function ol(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function ll(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let i in s){let o=s[i];if(o===void 0||o._def===void 0)continue;let l=ul(o),d=K(o._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});d!==void 0&&(a.properties[i]=d,l||r.push(i))}r.length&&(a.required=r);let n=dl(t,e);return n!==void 0&&(a.additionalProperties=n),a}function dl(t,e){if(t.catchall._def.typeName!=="ZodNever")return K(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function ul(t){try{return t.isOptional()}catch{return!0}}var cl=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return K(t.innerType._def,e);let a=K(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:ke()},a]}:ke()},pl=(t,e)=>{if(e.pipeStrategy==="input")return K(t.in._def,e);if(e.pipeStrategy==="output")return K(t.out._def,e);let a=K(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=K(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,r].filter(s=>s!==void 0)}};function ml(t,e){return K(t.type._def,e)}function hl(t,e){let a={type:"array",uniqueItems:!0,items:K(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function fl(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>K(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:K(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>K(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function gl(){return{not:ke()}}function yl(){return ke()}var vl=(t,e)=>K(t.innerType._def,e),_l=(t,e,a)=>{switch(e){case v.ZodString:return ms(t,a);case v.ZodNumber:return ol(t);case v.ZodObject:return ll(t,a);case v.ZodBigInt:return Uo(t);case v.ZodBoolean:return Vo();case v.ZodDate:return ps(t,a);case v.ZodUndefined:return gl();case v.ZodNull:return rl();case v.ZodArray:return zo(t,a);case v.ZodUnion:case v.ZodDiscriminatedUnion:return sl(t,a);case v.ZodIntersection:return Ho(t,a);case v.ZodTuple:return fl(t,a);case v.ZodRecord:return fs(t,a);case v.ZodLiteral:return Go(t);case v.ZodEnum:return Jo(t);case v.ZodNativeEnum:return tl(t);case v.ZodNullable:return il(t,a);case v.ZodOptional:return cl(t,a);case v.ZodMap:return el(t,a);case v.ZodSet:return hl(t,a);case v.ZodLazy:return()=>t.getter()._def;case v.ZodPromise:return ml(t,a);case v.ZodNaN:case v.ZodNever:return al();case v.ZodEffects:return Ko(t,a);case v.ZodAny:return ke();case v.ZodUnknown:return yl();case v.ZodDefault:return qo(t,a);case v.ZodBranded:return cs(t,a);case v.ZodReadonly:return vl(t,a);case v.ZodCatch:return Bo(t,a);case v.ZodPipeline:return pl(t,a);case v.ZodFunction:case v.ZodVoid:case v.ZodSymbol:return;default:return(r=>{})(e)}};function K(t,e,a=!1){var o;let r=e.seen.get(t);if(e.override){let l=(o=e.override)==null?void 0:o.call(e,t,e,r,a);if(l!==Do)return l}if(r&&!a){let l=bl(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=_l(t,t.typeName,e),i=typeof n=="function"?K(n(),e):n;if(i&&xl(t,e,i),e.postProcess){let l=e.postProcess(i,t,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}var bl=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Lo(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ke()):e.$refStrategy==="seen"?ke():void 0}},xl=(t,e,a)=>(t.description&&(a.description=t.description),a),wl=t=>{let e=Fo(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},kl=(t,e)=>{let a=wl(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[d,u])=>({...l,[d]:K(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,d]},!0)??ke()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=K(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??ke(),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i);let o=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return o.$schema="http://json-schema.org/draft-07/schema#",o};function Tl(t,e){let a=(e==null?void 0:e.useReferences)??!1;return Ka(kl(t,{$refStrategy:a?"root":"none"}),{validate:async r=>{let s=await t.safeParseAsync(r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Cl(t,e){let a=(e==null?void 0:e.useReferences)??!1,r=Sr(t,{target:"draft-7",io:"output",reused:a?"ref":"inline"});return Ka(r,{validate:async s=>{let n=await Xn(t,s);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function El(t){return"_zod"in t}function Il(t,e){return El(t)?Cl(t,e):Tl(t,e)}var qa=Symbol.for("vercel.ai.schema");function Ka(t,{validate:e}={}){return{[qa]:!0,_type:void 0,[ia]:!0,jsonSchema:t,validate:e}}function Sl(t){return typeof t=="object"&&!!t&&qa in t&&t[qa]===!0&&"jsonSchema"in t&&"validate"in t}function Al(t){return t==null?Ka({properties:{},additionalProperties:!1}):Sl(t)?t:Il(t)}var{btoa:Vc,atob:Bc}=globalThis,Ol=Object.defineProperty,Rl=(t,e)=>{for(var a in e)Ol(t,a,{get:e[a],enumerable:!0})},gs="AI_NoObjectGeneratedError",ys=`vercel.ai.error.${gs}`,Nl=Symbol.for(ys),vs,_s=class extends at{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:gs,message:t,cause:e}),this[vs]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return at.hasMarker(t,ys)}};vs=Nl;var bs=ue([h(),Vt(Uint8Array),Vt(ArrayBuffer),Hn(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Rt=ei(()=>ue([Qn(),h(),It(),re(),wa(h(),Rt),Be(Rt)])),D=wa(h(),wa(h(),Rt)),xs=S({type:T("text"),text:h(),providerOptions:D.optional()}),Ml=S({type:T("image"),image:ue([bs,Vt(URL)]),mediaType:h().optional(),providerOptions:D.optional()}),ws=S({type:T("file"),data:ue([bs,Vt(URL)]),filename:h().optional(),mediaType:h(),providerOptions:D.optional()}),Pl=S({type:T("reasoning"),text:h(),providerOptions:D.optional()}),jl=S({type:T("tool-call"),toolCallId:h(),toolName:h(),input:te(),providerOptions:D.optional(),providerExecuted:re().optional()}),Zl=Gn("type",[S({type:T("text"),value:h()}),S({type:T("json"),value:Rt}),S({type:T("error-text"),value:h()}),S({type:T("error-json"),value:Rt}),S({type:T("content"),value:Be(ue([S({type:T("text"),text:h()}),S({type:T("media"),data:h(),mediaType:h()})]))})]),ks=S({type:T("tool-result"),toolCallId:h(),toolName:h(),output:Zl,providerOptions:D.optional()}),$l=S({role:T("system"),content:h(),providerOptions:D.optional()}),Ll=S({role:T("user"),content:ue([h(),Be(ue([xs,Ml,ws]))]),providerOptions:D.optional()}),Dl=S({role:T("assistant"),content:ue([h(),Be(ue([xs,ws,Pl,jl,ks]))]),providerOptions:D.optional()}),Fl=S({role:T("tool"),content:Be(ks),providerOptions:D.optional()});ue([$l,Ll,Dl,Fl]),Ot({prefix:"aitxt",size:24});var Ts=ue([G({type:T("text-start"),id:h(),providerMetadata:D.optional()}),G({type:T("text-delta"),id:h(),delta:h(),providerMetadata:D.optional()}),G({type:T("text-end"),id:h(),providerMetadata:D.optional()}),G({type:T("error"),errorText:h()}),G({type:T("tool-input-start"),toolCallId:h(),toolName:h(),providerExecuted:re().optional(),dynamic:re().optional()}),G({type:T("tool-input-delta"),toolCallId:h(),inputTextDelta:h()}),G({type:T("tool-input-available"),toolCallId:h(),toolName:h(),input:te(),providerExecuted:re().optional(),providerMetadata:D.optional(),dynamic:re().optional()}),G({type:T("tool-input-error"),toolCallId:h(),toolName:h(),input:te(),providerExecuted:re().optional(),providerMetadata:D.optional(),dynamic:re().optional(),errorText:h()}),G({type:T("tool-output-available"),toolCallId:h(),output:te(),providerExecuted:re().optional(),dynamic:re().optional(),preliminary:re().optional()}),G({type:T("tool-output-error"),toolCallId:h(),errorText:h(),providerExecuted:re().optional(),dynamic:re().optional()}),G({type:T("reasoning"),text:h(),providerMetadata:D.optional()}),G({type:T("reasoning-start"),id:h(),providerMetadata:D.optional()}),G({type:T("reasoning-delta"),id:h(),delta:h(),providerMetadata:D.optional()}),G({type:T("reasoning-end"),id:h(),providerMetadata:D.optional()}),G({type:T("reasoning-part-finish")}),G({type:T("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:D.optional()}),G({type:T("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:D.optional()}),G({type:T("file"),url:h(),mediaType:h(),providerMetadata:D.optional()}),G({type:h().startsWith("data-"),id:h().optional(),data:te(),transient:re().optional()}),G({type:T("start-step")}),G({type:T("finish-step")}),G({type:T("start"),messageId:h().optional(),messageMetadata:te().optional()}),G({type:T("finish"),messageMetadata:te().optional()}),G({type:T("abort")}),G({type:T("message-metadata"),messageMetadata:te()})]);function zl(t){return t.type.startsWith("data-")}function Cs(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,i=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),o=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);i&&o?a[r]=Cs(n,s):a[r]=s}return a}function Ul(t){let e=["ROOT"],a=-1,r=null;function s(l,d,u){switch(l){case'"':a=d,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=d,r=d,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=d,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=d,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(l,d){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=d,e.pop();break}}function i(l,d){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break}}for(let l=0;l<t.length;l++){let d=t[l];switch(e[e.length-1]){case"ROOT":s(d,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(d){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(d,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(d,l);break;case"INSIDE_STRING":switch(d){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":switch(d){case"]":a=l,e.pop();break;default:a=l,s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,l+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(d,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l)):a=l;break}}}let o=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let d=t.substring(r,t.length);"true".startsWith(d)?o+="true".slice(d.length):"false".startsWith(d)?o+="false".slice(d.length):"null".startsWith(d)&&(o+="null".slice(d.length))}}return o}async function Es(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await oa({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await oa({text:Ul(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function la(t){return t.type.startsWith("tool-")}function Vl(t){return t.type==="dynamic-tool"}function Is(t){return la(t)||Vl(t)}function Ss(t){return t.type.split("-").slice(1).join("-")}function Bl({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function Wl({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:i}){return t.pipeThrough(new TransformStream({async transform(o,l){await r(async({state:d,write:u})=>{function p(c){let m=d.message.parts.filter(la).find(b=>b.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function _(c){let m=d.message.parts.filter(b=>b.type==="dynamic-tool").find(b=>b.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function y(c){let m=d.message.parts.find(A=>la(A)&&A.toolCallId===c.toolCallId),b=c,C=m;m==null?d.message.parts.push({type:`tool-${c.toolName}`,toolCallId:c.toolCallId,state:c.state,input:b.input,output:b.output,rawInput:b.rawInput,errorText:b.errorText,providerExecuted:b.providerExecuted,preliminary:b.preliminary,...b.providerMetadata==null?{}:{callProviderMetadata:b.providerMetadata}}):(m.state=c.state,C.input=b.input,C.output=b.output,C.errorText=b.errorText,C.rawInput=b.rawInput,C.preliminary=b.preliminary,C.providerExecuted=b.providerExecuted??m.providerExecuted,b.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=b.providerMetadata))}function x(c){let m=d.message.parts.find(A=>A.type==="dynamic-tool"&&A.toolCallId===c.toolCallId),b=c,C=m;m==null?d.message.parts.push({type:"dynamic-tool",toolName:c.toolName,toolCallId:c.toolCallId,state:c.state,input:b.input,output:b.output,errorText:b.errorText,preliminary:b.preliminary,...b.providerMetadata==null?{}:{callProviderMetadata:b.providerMetadata}}):(m.state=c.state,C.toolName=c.toolName,C.input=b.input,C.output=b.output,C.errorText=b.errorText,C.rawInput=b.rawInput??C.rawInput,C.preliminary=b.preliminary,b.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=b.providerMetadata))}async function f(c){if(c!=null){let m=d.message.metadata==null?c:Cs(d.message.metadata,c);e!=null&&await ls({value:m,schema:e}),d.message.metadata=m}}switch(o.type){case"text-start":{let c={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};d.activeTextParts[o.id]=c,d.message.parts.push(c),u();break}case"text-delta":{let c=d.activeTextParts[o.id];c.text+=o.delta,c.providerMetadata=o.providerMetadata??c.providerMetadata,u();break}case"text-end":{let c=d.activeTextParts[o.id];c.state="done",c.providerMetadata=o.providerMetadata??c.providerMetadata,delete d.activeTextParts[o.id],u();break}case"reasoning-start":{let c={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};d.activeReasoningParts[o.id]=c,d.message.parts.push(c),u();break}case"reasoning-delta":{let c=d.activeReasoningParts[o.id];c.text+=o.delta,c.providerMetadata=o.providerMetadata??c.providerMetadata,u();break}case"reasoning-end":{let c=d.activeReasoningParts[o.id];c.providerMetadata=o.providerMetadata??c.providerMetadata,c.state="done",delete d.activeReasoningParts[o.id],u();break}case"file":d.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),u();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),u();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),u();break;case"tool-input-start":{let c=d.message.parts.filter(la);d.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:c.length,dynamic:o.dynamic},o.dynamic?x({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0}):y({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}),u();break}case"tool-input-delta":{let c=d.partialToolCalls[o.toolCallId];c.text+=o.inputTextDelta;let{value:m}=await Es(c.text);c.dynamic?x({toolCallId:o.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}):y({toolCallId:o.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}),u();break}case"tool-input-available":o.dynamic?x({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerMetadata:o.providerMetadata}):y({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u(),n&&!o.providerExecuted&&await n({toolCall:o});break;case"tool-input-error":o.dynamic?x({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerMetadata:o.providerMetadata}):y({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u();break;case"tool-output-available":if(o.dynamic){let c=_(o.toolCallId);x({toolCallId:o.toolCallId,toolName:c.toolName,state:"output-available",input:c.input,output:o.output,preliminary:o.preliminary})}else{let c=p(o.toolCallId);y({toolCallId:o.toolCallId,toolName:Ss(c),state:"output-available",input:c.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary})}u();break;case"tool-output-error":if(o.dynamic){let c=_(o.toolCallId);x({toolCallId:o.toolCallId,toolName:c.toolName,state:"output-error",input:c.input,errorText:o.errorText})}else{let c=p(o.toolCallId);y({toolCallId:o.toolCallId,toolName:Ss(c),state:"output-error",input:c.input,rawInput:c.rawInput,errorText:o.errorText})}u();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":o.messageId!=null&&(d.message.id=o.messageId),await f(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&u();break;case"finish":await f(o.messageMetadata),o.messageMetadata!=null&&u();break;case"message-metadata":await f(o.messageMetadata),o.messageMetadata!=null&&u();break;case"error":s==null||s(Error(o.errorText));break;default:if(zl(o)){(a==null?void 0:a[o.type])!=null&&await ls({value:o.data,schema:a[o.type]});let c=o;if(c.transient){i==null||i(c);break}let m=c.id==null?void 0:d.message.parts.find(b=>c.type===b.type&&c.id===b.id);m==null?d.message.parts.push(c):m.data=c.data,i==null||i(c),u()}}l.enqueue(o)})}}))}async function As({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}Ot({prefix:"aitxt",size:24}),Ot({prefix:"aiobj",size:24});var ql=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};Ot({prefix:"aiobj",size:24}),Rl({},{object:()=>Jl,text:()=>Kl});var Kl=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),Jl=({schema:t})=>{let e=Al(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await Es(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await oa({text:a});if(!s.success)throw new _s({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await Ua({value:s.value,schema:e});if(!n.success)throw new _s({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}},Yl=yt({name:h(),version:h()}),Ja=yt({_meta:de(S({}).loose())}),Nt=Ja,Hl=S({method:h(),params:de(Ja)}),Gl=yt({experimental:de(S({}).loose()),logging:de(S({}).loose()),prompts:de(yt({listChanged:de(re())})),resources:de(yt({subscribe:de(re()),listChanged:de(re())})),tools:de(yt({listChanged:de(re())}))});Nt.extend({protocolVersion:h(),capabilities:Gl,serverInfo:Yl,instructions:de(h())});var Ql=Nt.extend({nextCursor:de(h())}),Xl=S({name:h(),description:de(h()),inputSchema:S({type:T("object"),properties:de(S({}).loose())}).loose()}).loose();Ql.extend({tools:Be(Xl)});var ed=S({type:T("text"),text:h()}).loose(),td=S({type:T("image"),data:Ar(),mimeType:h()}).loose(),Os=S({uri:h(),mimeType:de(h())}).loose(),ad=Os.extend({text:h()}),rd=Os.extend({blob:Ar()}),sd=S({type:T("resource"),resource:ue([ad,rd])}).loose();Nt.extend({content:Be(ue([ed,td,sd])),isError:re().default(!1).optional()}).or(Nt.extend({toolResult:te()}));var da="2.0",nd=S({jsonrpc:T(da),id:ue([h(),It().int()])}).merge(Hl).strict(),id=S({jsonrpc:T(da),id:ue([h(),It().int()]),result:Nt}).strict(),od=S({jsonrpc:T(da),id:ue([h(),It().int()]),error:S({code:It().int(),message:h(),data:de(te())})}).strict(),ld=S({jsonrpc:T(da)}).merge(S({method:h(),params:de(Ja)})).strict();ue([nd,ld,id,od]);async function dd({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var ud=()=>fetch;async function cd({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:i,setLoading:o,setError:l,setAbortController:d,onFinish:u,onError:p,fetch:_=ud()}){try{o(!0),l(void 0);let y=new AbortController;d(y),i("");let x=await _(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:{"Content-Type":"application/json",...r},signal:y.signal}).catch(c=>{throw c});if(!x.ok)throw Error(await x.text()??"Failed to fetch the chat response.");if(!x.body)throw Error("The response body is empty.");let f="";switch(n){case"text":await dd({stream:x.body,onTextPart:c=>{f+=c,i(f)}});break;case"data":await As({stream:ds({stream:x.body,schema:Ts}).pipeThrough(new TransformStream({async transform(c){if(!c.success)throw c.error;let m=c.value;if(m.type==="text-delta")f+=m.delta,i(f);else if(m.type==="error")throw Error(m.errorText)}})),onError:c=>{throw c}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,f),d(null),f}catch(y){if(y.name==="AbortError")return d(null),null;y instanceof Error&&p&&p(y),l(y)}finally{o(!1)}}async function pd(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e,s=await new Promise((n,i)=>{let o=new FileReader;o.onload=l=>{var d;n((d=l.target)==null?void 0:d.result)},o.onerror=l=>i(l),o.readAsDataURL(e)});return{type:"file",mediaType:r,filename:a,url:s}}))}var md=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:i}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:t,...e}){var p;let a=await wt(this.body),r=await wt(this.headers),s=await wt(this.credentials),n=await((p=this.prepareSendMessagesRequest)==null?void 0:p.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:{...r,...e.headers},credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),i=(n==null?void 0:n.api)??this.api,o=(n==null?void 0:n.headers)===void 0?{...r,...e.headers}:n.headers,l=(n==null?void 0:n.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:n.body,d=(n==null?void 0:n.credentials)??s,u=await(this.fetch??globalThis.fetch)(i,{method:"POST",headers:{"Content-Type":"application/json",...o},body:JSON.stringify(l),credentials:d,signal:t});if(!u.ok)throw Error(await u.text()??"Failed to fetch the chat response.");if(!u.body)throw Error("The response body is empty.");return this.processResponseStream(u.body)}async reconnectToStream(t){var d;let e=await wt(this.body),a=await wt(this.headers),r=await wt(this.credentials),s=await((d=this.prepareReconnectToStreamRequest)==null?void 0:d.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:{...a,...t.headers},credentials:r,requestMetadata:t.metadata})),n=(s==null?void 0:s.api)??`${this.api}/${t.chatId}/stream`,i=(s==null?void 0:s.headers)===void 0?{...a,...t.headers}:s.headers,o=(s==null?void 0:s.credentials)??r,l=await(this.fetch??globalThis.fetch)(n,{method:"GET",headers:i,credentials:o});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??"Failed to fetch the chat response.");if(!l.body)throw Error("The response body is empty.");return this.processResponseStream(l.body)}},Ya=class extends md{constructor(t={}){super(t)}processResponseStream(t){return ds({stream:t,schema:Ts}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},hd=class{constructor({generateId:t=So,id:e=t(),transport:a=new Ya,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:i,onToolCall:o,onFinish:l,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new ql,this.sendMessage=async(p,_)=>{var x;if(p==null){await this.makeRequest({trigger:"submit-message",messageId:(x=this.lastMessage)==null?void 0:x.id,..._});return}let y;if(y="text"in p||"files"in p?{parts:[...Array.isArray(p.files)?p.files:await pd(p.files),..."text"in p&&p.text!=null?[{type:"text",text:p.text}]:[]]}:p,p.messageId!=null){let f=this.state.messages.findIndex(c=>c.id===p.messageId);if(f===-1)throw Error(`message with id ${p.messageId} not found`);if(this.state.messages[f].role!=="user")throw Error(`message with id ${p.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,f+1),this.state.replaceMessage(f,{...y,id:p.messageId,role:y.role??"user",metadata:p.metadata})}else this.state.pushMessage({...y,id:y.id??this.generateId(),role:y.role??"user",metadata:p.metadata});await this.makeRequest({trigger:"submit-message",messageId:p.messageId,..._})},this.regenerate=async({messageId:p,..._}={})=>{let y=p==null?this.state.messages.length-1:this.state.messages.findIndex(x=>x.id===p);if(y===-1)throw Error(`message ${p} not found`);this.state.messages=this.state.messages.slice(0,this.messages[y].role==="assistant"?y:y+1),await this.makeRequest({trigger:"regenerate-message",messageId:p,..._})},this.resumeStream=async(p={})=>{await this.makeRequest({trigger:"resume-stream",...p})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:p,toolCallId:_,output:y})=>this.jobExecutor.run(async()=>{var c,m;let x=this.state.messages,f=x[x.length-1];this.state.replaceMessage(x.length-1,{...f,parts:f.parts.map(b=>Is(b)&&b.toolCallId===_?{...b,state:"output-available",output:y}:b)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(b=>Is(b)&&b.toolCallId===_?{...b,state:"output-available",output:y,errorText:void 0}:b)),this.status!=="streaming"&&this.status!=="submitted"&&((c=this.sendAutomaticallyWhen)!=null&&c.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(m=this.lastMessage)==null?void 0:m.id})}),this.stop=async()=>{var p;this.status!=="streaming"&&this.status!=="submitted"||(p=this.activeResponse)!=null&&p.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=i,this.onToolCall=o,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,p;var n;this.setStatus({status:"submitted",error:void 0});let i=this.lastMessage,o=!1,l=!1,d=!1;try{let _={state:Bl({lastMessage:this.state.snapshot(i),messageId:this.generateId()}),abortController:new AbortController};_.abortController.signal.addEventListener("abort",()=>{o=!0}),this.activeResponse=_;let y;if(t==="resume-stream"){let x=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(x==null){this.setStatus({status:"ready"});return}y=x}else y=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:_.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await As({stream:Wl({stream:y,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:x=>this.jobExecutor.run(()=>x({state:_.state,write:()=>{var f;this.setStatus({status:"streaming"}),_.state.message.id===((f=this.lastMessage)==null?void 0:f.id)?this.state.replaceMessage(this.state.messages.length-1,_.state.message):this.state.pushMessage(_.state.message)}})),onError:x=>{throw x}}),onError:x=>{throw x}}),this.setStatus({status:"ready"})}catch(_){if(o||_.name==="AbortError")return o=!0,this.setStatus({status:"ready"}),null;d=!0,_ instanceof TypeError&&(_.message.toLowerCase().includes("fetch")||_.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&_ instanceof Error&&this.onError(_),this.setStatus({status:"error",error:_})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:o,isDisconnect:l,isError:d})}catch(_){console.error(_)}this.activeResponse=void 0}(u=this.sendAutomaticallyWhen)!=null&&u.call(this,{messages:this.state.messages})&&await this.makeRequest({trigger:"submit-message",messageId:(p=this.lastMessage)==null?void 0:p.id,metadata:e,headers:a,body:r})}},fd=S({type:T("text"),text:h(),state:ka(["streaming","done"]).optional(),providerMetadata:D.optional()}),gd=S({type:T("reasoning"),text:h(),state:ka(["streaming","done"]).optional(),providerMetadata:D.optional()}),yd=S({type:T("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:D.optional()}),vd=S({type:T("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:D.optional()}),_d=S({type:T("file"),mediaType:h(),filename:h().optional(),url:h(),providerMetadata:D.optional()}),bd=S({type:T("step-start")}),xd=S({type:h().startsWith("data-"),id:h().optional(),data:te()}),wd=[S({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("input-streaming"),input:te().optional(),output:Ie().optional(),errorText:Ie().optional()}),S({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("input-available"),input:te(),output:Ie().optional(),errorText:Ie().optional(),callProviderMetadata:D.optional()}),S({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("output-available"),input:te(),output:te(),errorText:Ie().optional(),callProviderMetadata:D.optional(),preliminary:re().optional()}),S({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("output-error"),input:te(),output:Ie().optional(),errorText:h(),callProviderMetadata:D.optional()})],kd=[S({type:h().startsWith("tool-"),toolCallId:h(),state:T("input-streaming"),input:te().optional(),output:Ie().optional(),errorText:Ie().optional()}),S({type:h().startsWith("tool-"),toolCallId:h(),state:T("input-available"),input:te(),output:Ie().optional(),errorText:Ie().optional(),callProviderMetadata:D.optional()}),S({type:h().startsWith("tool-"),toolCallId:h(),state:T("output-available"),input:te(),output:te(),errorText:Ie().optional(),callProviderMetadata:D.optional(),preliminary:re().optional()}),S({type:h().startsWith("tool-"),toolCallId:h(),state:T("output-error"),input:te(),output:Ie().optional(),errorText:h(),callProviderMetadata:D.optional()})];S({id:h(),role:ka(["system","user","assistant"]),metadata:te().optional(),parts:Be(ue([fd,gd,yd,vd,_d,bd,xd,...wd,...kd]))});var Td=En(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,i=0;return function(...o){clearTimeout(n);let l=Date.now(),d=l-i,u=s-d;u<=0?(i=l,r.apply(this,o)):n=setTimeout(()=>{i=Date.now(),r.apply(this,o)},u)}}e.exports=a})),Rs=Object.prototype.hasOwnProperty;function Ha(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&Ha(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(Rs.call(t,a)&&++r&&!Rs.call(e,a)||!(a in e)||!Ha(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var N=et(An(),1),Ke=new WeakMap,pt=()=>{},me=void 0,ua=Object,F=t=>t===me,Pe=t=>typeof t=="function",Je=(t,e)=>({...t,...e}),Ns=t=>Pe(t.then),Ga={},ca={},Qa="undefined",Mt=typeof window!=Qa,Xa=typeof document!=Qa,Cd=Mt&&"Deno"in window,Ed=()=>Mt&&typeof window.requestAnimationFrame!=Qa,Ms=(t,e)=>{let a=Ke.get(t);return[()=>!F(e)&&t.get(e)||Ga,r=>{if(!F(e)){let s=t.get(e);e in ca||(ca[e]=s),a[5](e,Je(s,r),s||Ga)}},a[6],()=>!F(e)&&e in ca?ca[e]:!F(e)&&t.get(e)||Ga]},er=!0,Id=()=>er,[tr,ar]=Mt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[pt,pt],Sd=()=>{let t=Xa&&document.visibilityState;return F(t)||t!=="hidden"},Ad=t=>(Xa&&document.addEventListener("visibilitychange",t),tr("focus",t),()=>{Xa&&document.removeEventListener("visibilitychange",t),ar("focus",t)}),Od=t=>{let e=()=>{er=!0,t()},a=()=>{er=!1};return tr("online",e),tr("offline",a),()=>{ar("online",e),ar("offline",a)}},Rd={isOnline:Id,isVisible:Sd},Nd={initFocus:Ad,initReconnect:Od},Ps=!N.useId,Pt=!Mt||Cd,Md=t=>Ed()?window.requestAnimationFrame(t):setTimeout(t,1),pa=Pt?N.useEffect:N.useLayoutEffect,rr=typeof navigator<"u"&&navigator.connection,js=!Pt&&rr&&(["slow-2g","2g"].includes(rr.effectiveType)||rr.saveData),ma=new WeakMap,Pd=t=>ua.prototype.toString.call(t),sr=(t,e)=>t===`[object ${e}]`,jd=0,nr=t=>{let e=typeof t,a=Pd(t),r=sr(a,"Date"),s=sr(a,"RegExp"),n=sr(a,"Object"),i,o;if(ua(t)===t&&!r&&!s){if(i=ma.get(t),i)return i;if(i=++jd+"~",ma.set(t,i),Array.isArray(t)){for(i="@",o=0;o<t.length;o++)i+=nr(t[o])+",";ma.set(t,i)}if(n){i="#";let l=ua.keys(t).sort();for(;!F(o=l.pop());)F(t[o])||(i+=o+":"+nr(t[o])+",");ma.set(t,i)}}else i=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return i},ir=t=>{if(Pe(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?nr(t):"",[t,e]},Zd=0,or=()=>++Zd;async function Zs(...t){let[e,a,r,s]=t,n=Je({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),i=n.populateCache,o=n.rollbackOnError,l=n.optimisticData,d=_=>typeof o=="function"?o(_):o!==!1,u=n.throwOnError;if(Pe(a)){let _=a,y=[],x=e.keys();for(let f of x)!/^\$(inf|sub)\$/.test(f)&&_(e.get(f)._k)&&y.push(f);return Promise.all(y.map(p))}return p(a);async function p(_){let[y]=ir(_);if(!y)return;let[x,f]=Ms(e,y),[c,m,b,C]=Ke.get(e),A=()=>{let Y=c[y];return(Pe(n.revalidate)?n.revalidate(x().data,_):n.revalidate!==!1)&&(delete b[y],delete C[y],Y&&Y[0])?Y[0](2).then(()=>x().data):x().data};if(t.length<3)return A();let I=r,j,U=!1,P=or();m[y]=[P,0];let X=!F(l),$=x(),oe=$.data,le=$._c,ae=F(le)?oe:le;if(X&&(l=Pe(l)?l(ae,oe):l,f({data:l,_c:ae})),Pe(I))try{I=I(ae)}catch(Y){j=Y,U=!0}if(I&&Ns(I))if(I=await I.catch(Y=>{j=Y,U=!0}),P!==m[y][0]){if(U)throw j;return I}else U&&X&&d(j)&&(i=!0,f({data:ae,_c:me}));if(i&&!U)if(Pe(i)){let Y=i(I,ae);f({data:Y,error:me,_c:me})}else f({data:I,error:me,_c:me});if(m[y][1]=or(),Promise.resolve(A()).then(()=>{f({_c:me})}),U){if(u)throw j;return}return I}}var $s=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},Ls=(t,e)=>{if(!Ke.has(t)){let a=Je(Nd,e),r=Object.create(null),s=Zs.bind(me,t),n=pt,i=Object.create(null),o=(u,p)=>{let _=i[u]||[];return i[u]=_,_.push(p),()=>_.splice(_.indexOf(p),1)},l=(u,p,_)=>{t.set(u,p);let y=i[u];if(y)for(let x of y)x(p,_)},d=()=>{if(!Ke.has(t)&&(Ke.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,o]),!Pt)){let u=a.initFocus(setTimeout.bind(me,$s.bind(me,r,0))),p=a.initReconnect(setTimeout.bind(me,$s.bind(me,r,1)));n=()=>{u&&u(),p&&p(),Ke.delete(t)}}};return d(),[t,s,d,n]}return[t,Ke.get(t)[4]]},$d=(t,e,a,r,s)=>{let n=a.errorRetryCount,i=s.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*a.errorRetryInterval;!F(n)&&i>n||setTimeout(r,o,s)},Ld=Ha,[lr,Dd]=Ls(new Map),Ds=Je({onLoadingSlow:pt,onSuccess:pt,onError:pt,onErrorRetry:$d,onDiscarded:pt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:js?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:js?5e3:3e3,compare:Ld,isPaused:()=>!1,cache:lr,mutate:Dd,fallback:{}},Rd),Fs=(t,e)=>{let a=Je(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:i}=e;r&&n&&(a.use=r.concat(n)),s&&i&&(a.fallback=Je(s,i))}return a},dr=(0,N.createContext)({}),Fd=t=>{let{value:e}=t,a=(0,N.useContext)(dr),r=Pe(e),s=(0,N.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,N.useMemo)(()=>r?s:Fs(a,s),[r,a,s]),i=s&&s.provider,o=(0,N.useRef)(me);i&&!o.current&&(o.current=Ls(i(n.cache||lr),s));let l=o.current;return l&&(n.cache=l[0],n.mutate=l[1]),pa(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,N.createElement)(dr.Provider,Je(t,{value:n}))},zs=Mt&&window.__SWR_DEVTOOLS_USE__,zd=zs?window.__SWR_DEVTOOLS_USE__:[],Ud=()=>{zs&&(window.__SWR_DEVTOOLS_REACT__=N.default)},Vd=t=>Pe(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],Bd=()=>Je(Ds,(0,N.useContext)(dr)),Wd=zd.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=ir(e),[,,,i]=Ke.get(lr);if(n.startsWith("$inf$"))return a(...s);let o=i[n];return F(o)?a(...s):(delete i[n],o)}),r)),qd=t=>function(...e){let a=Bd(),[r,s,n]=Vd(e),i=Fs(a,n),o=t,{use:l}=i,d=(l||[]).concat(Wd);for(let u=d.length;u--;)o=d[u](o);return o(r,s||i.fetcher||null,i)},Kd=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};Ud();var Jd=et(Ni(),1),ur=N.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),cr={dedupe:!0},Yd=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:i,revalidateOnMount:o,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:p,keepPreviousData:_}=a,[y,x,f,c]=Ke.get(r),[m,b]=ir(t),C=(0,N.useRef)(!1),A=(0,N.useRef)(!1),I=(0,N.useRef)(m),j=(0,N.useRef)(e),U=(0,N.useRef)(a),P=()=>U.current,X=()=>P().isVisible()&&P().isOnline(),[$,oe,le,ae]=Ms(r,m),Y=(0,N.useRef)({}).current,he=F(i)?F(a.fallback)?me:a.fallback[m]:i,J=(V,L)=>{for(let ee in Y){let B=ee;if(B==="data"){if(!s(V[B],L[B])&&(!F(V[B])||!s(Oe,L[B])))return!1}else if(L[B]!==V[B])return!1}return!0},q=(0,N.useMemo)(()=>{let V=!m||!e?!1:F(o)?P().isPaused()||n?!1:l!==!1:o,L=ne=>{let be=Je(ne);return delete be._k,V?{isValidating:!0,isLoading:!0,...be}:be},ee=$(),B=ae(),Ce=L(ee),ge=ee===B?Ce:L(B),se=Ce;return[()=>{let ne=L($());return J(ne,se)?(se.data=ne.data,se.isLoading=ne.isLoading,se.isValidating=ne.isValidating,se.error=ne.error,se):(se=ne,ne)},()=>ge]},[r,m]),H=(0,Jd.useSyncExternalStore)((0,N.useCallback)(V=>le(m,(L,ee)=>{J(ee,L)||V()}),[r,m]),q[0],q[1]),Ae=!C.current,ve=y[m]&&y[m].length>0,_e=H.data,Te=F(_e)?he&&Ns(he)?ur(he):he:_e,He=H.error,Ge=(0,N.useRef)(Te),Oe=_?F(_e)?F(Ge.current)?Te:Ge.current:_e:Te,lt=ve&&!F(He)?!1:Ae&&!F(o)?o:P().isPaused()?!1:n?F(Te)?!1:l:F(Te)||l,Fe=!!(m&&e&&Ae&&lt),gt=F(H.isValidating)?Fe:H.isValidating,Qe=F(H.isLoading)?Fe:H.isLoading,Ze=(0,N.useCallback)(async V=>{let L=j.current;if(!m||!L||A.current||P().isPaused())return!1;let ee,B,Ce=!0,ge=V||{},se=!f[m]||!ge.dedupe,ne=()=>Ps?!A.current&&m===I.current&&C.current:m===I.current,be={isValidating:!1,isLoading:!1},Ue=()=>{oe(be)},Ve=()=>{let ie=f[m];ie&&ie[1]===B&&delete f[m]},dt={isValidating:!0};F($().data)&&(dt.isLoading=!0);try{if(se&&(oe(dt),a.loadingTimeout&&F($().data)&&setTimeout(()=>{Ce&&ne()&&P().onLoadingSlow(m,a)},a.loadingTimeout),f[m]=[L(b),or()]),[ee,B]=f[m],ee=await ee,se&&setTimeout(Ve,a.dedupingInterval),!f[m]||f[m][1]!==B)return se&&ne()&&P().onDiscarded(m),!1;be.error=me;let ie=x[m];if(!F(ie)&&(B<=ie[0]||B<=ie[1]||ie[1]===0))return Ue(),se&&ne()&&P().onDiscarded(m),!1;let pe=$().data;be.data=s(pe,ee)?pe:ee,se&&ne()&&P().onSuccess(ee,m,a)}catch(ie){Ve();let pe=P(),{shouldRetryOnError:Xe}=pe;pe.isPaused()||(be.error=ie,se&&ne()&&(pe.onError(ie,m,pe),(Xe===!0||Pe(Xe)&&Xe(ie))&&(!P().revalidateOnFocus||!P().revalidateOnReconnect||X())&&pe.onErrorRetry(ie,m,pe,xe=>{let Ee=y[m];Ee&&Ee[0]&&Ee[0](3,xe)},{retryCount:(ge.retryCount||0)+1,dedupe:!0})))}return Ce=!1,Ue(),!0},[m,r]),ze=(0,N.useCallback)((...V)=>Zs(r,I.current,...V),[]);if(pa(()=>{j.current=e,U.current=a,F(_e)||(Ge.current=_e)}),pa(()=>{if(!m)return;let V=Ze.bind(me,cr),L=0;P().revalidateOnFocus&&(L=Date.now()+P().focusThrottleInterval);let ee=Kd(m,y,(B,Ce={})=>{if(B==0){let ge=Date.now();P().revalidateOnFocus&&ge>L&&X()&&(L=ge+P().focusThrottleInterval,V())}else if(B==1)P().revalidateOnReconnect&&X()&&V();else{if(B==2)return Ze();if(B==3)return Ze(Ce)}});return A.current=!1,I.current=m,C.current=!0,oe({_k:b}),lt&&(f[m]||(F(Te)||Pt?V():Md(V))),()=>{A.current=!0,ee()}},[m]),pa(()=>{let V;function L(){let B=Pe(d)?d($().data):d;B&&V!==-1&&(V=setTimeout(ee,B))}function ee(){!$().error&&(u||P().isVisible())&&(p||P().isOnline())?Ze(cr).then(L):L()}return L(),()=>{V&&(V=(clearTimeout(V),-1))}},[d,u,p,m]),(0,N.useDebugValue)(Oe),n&&F(Te)&&m){if(!Ps&&Pt)throw Error("Fallback data is required when using Suspense in SSR.");j.current=e,U.current=a,A.current=!1;let V=c[m];if(!F(V)){let L=ze(V);ur(L)}if(F(He)){let L=Ze(cr);F(Oe)||(L.status="fulfilled",L.value=!0),ur(L)}else throw He}return{mutate:ze,get data(){return Y.data=!0,Oe},get error(){return Y.error=!0,He},get isValidating(){return Y.isValidating=!0,gt},get isLoading(){return Y.isLoading=!0,Qe}}};ua.defineProperty(Fd,"defaultValue",{value:Ds});var Us=qd(Yd),Hd=et(Td(),1),Vs=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},Q=(t,e,a)=>(Vs(t,e,"read from private field"),a?a.call(t):e.get(t)),De=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},it=(t,e,a,r)=>(Vs(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function Bs(t,e){return e==null?t:(0,Hd.default)(t,e)}var Se,ha,fa,jt,Zt,$t,kt,pr,mr,Gd=class{constructor(t=[]){De(this,Se,void 0),De(this,ha,"ready"),De(this,fa,void 0),De(this,jt,new Set),De(this,Zt,new Set),De(this,$t,new Set),this.pushMessage=e=>{it(this,Se,Q(this,Se).concat(e)),Q(this,kt).call(this)},this.popMessage=()=>{it(this,Se,Q(this,Se).slice(0,-1)),Q(this,kt).call(this)},this.replaceMessage=(e,a)=>{it(this,Se,[...Q(this,Se).slice(0,e),this.snapshot(a),...Q(this,Se).slice(e+1)]),Q(this,kt).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?Bs(e,a):e;return Q(this,jt).add(r),()=>{Q(this,jt).delete(r)}},this["~registerStatusCallback"]=e=>(Q(this,Zt).add(e),()=>{Q(this,Zt).delete(e)}),this["~registerErrorCallback"]=e=>(Q(this,$t).add(e),()=>{Q(this,$t).delete(e)}),De(this,kt,()=>{Q(this,jt).forEach(e=>e())}),De(this,pr,()=>{Q(this,Zt).forEach(e=>e())}),De(this,mr,()=>{Q(this,$t).forEach(e=>e())}),it(this,Se,t)}get status(){return Q(this,ha)}set status(t){it(this,ha,t),Q(this,pr).call(this)}get error(){return Q(this,fa)}set error(t){it(this,fa,t),Q(this,mr).call(this)}get messages(){return Q(this,Se)}set messages(t){it(this,Se,[...t]),Q(this,kt).call(this)}};Se=new WeakMap,ha=new WeakMap,fa=new WeakMap,jt=new WeakMap,Zt=new WeakMap,$t=new WeakMap,kt=new WeakMap,pr=new WeakMap,mr=new WeakMap;var Tt,Ws=class extends hd{constructor({messages:t,...e}){let a=new Gd(t);super({...e,state:a}),De(this,Tt,void 0),this["~registerMessagesCallback"]=(r,s)=>Q(this,Tt)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>Q(this,Tt)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>Q(this,Tt)["~registerErrorCallback"](r),it(this,Tt,a)}};Tt=new WeakMap;function qs({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,N.useRef)("chat"in a?a.chat:new Ws(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new Ws(a));let s="id"in a?a.id:null,n=(0,N.useCallback)(u=>r.current["~registerMessagesCallback"](u,t),[t,s]),i=(0,N.useSyncExternalStore)(n,()=>r.current.messages,()=>r.current.messages),o=(0,N.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),l=(0,N.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),d=(0,N.useCallback)(u=>{typeof u=="function"&&(u=u(r.current.messages)),r.current.messages=u},[r]);return(0,N.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:i,setMessages:d,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:l,resumeStream:r.current.resumeStream,status:o,addToolResult:r.current.addToolResult}}function Qd({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:i,streamProtocol:o="data",fetch:l,onFinish:d,onError:u,experimental_throttle:p}={}){let _=(0,N.useId)(),y=e||_,{data:x,mutate:f}=Us([t,y],null,{fallbackData:a}),{data:c=!1,mutate:m}=Us([y,"loading"],null),[b,C]=(0,N.useState)(void 0),A=x,[I,j]=(0,N.useState)(null),U=(0,N.useRef)({credentials:s,headers:n,body:i});(0,N.useEffect)(()=>{U.current={credentials:s,headers:n,body:i}},[s,n,i]);let P=(0,N.useCallback)(async(J,q)=>cd({api:t,prompt:J,credentials:U.current.credentials,headers:{...U.current.headers,...q==null?void 0:q.headers},body:{...U.current.body,...q==null?void 0:q.body},streamProtocol:o,fetch:l,setCompletion:Bs(H=>f(H,!1),p),setLoading:m,setError:C,setAbortController:j,onFinish:d,onError:u}),[f,m,t,U,j,d,u,C,o,l,p]),X=(0,N.useCallback)(()=>{I&&(I.abort(),j(null))},[I]),$=(0,N.useCallback)(J=>{f(J,!1)},[f]),oe=(0,N.useCallback)(async(J,q)=>P(J,q),[P]),[le,ae]=(0,N.useState)(r),Y=(0,N.useCallback)(J=>{var q;return(q=J==null?void 0:J.preventDefault)==null||q.call(J),le?oe(le):void 0},[le,oe]),he=(0,N.useCallback)(J=>{ae(J.target.value)},[ae]);return{completion:A,complete:oe,error:b,setCompletion:$,stop:X,input:le,setInput:ae,handleInputChange:he,handleSubmit:Y,isLoading:c}}var Ks,Lt;function Xd(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(i){n[i]=r[i]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(i,o){return o(t,e,i)||i},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const hr=new(Ks=Er(),Lt=class{constructor(t=[]){W(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e){let a=this.getToolOrThrow(t),r=a.handler,s=a.schema,n=a.outputSchema;try{let i=await s.safeParseAsync(e);if(i.error){let u=Or(i.error);throw Error(`Tool ${t} returned invalid input: ${u}`)}let o=i.data,l=await r(o),d=await n.safeParseAsync(l);if(d.error){let u=Or(d.error);throw Error(`Tool ${t} returned invalid output: ${u}`)}return d.data}catch(i){return{status:"error",code:"TOOL_ERROR",message:i instanceof Error?i.message:String(i),suggestedFix:"Try again with valid arguments.",meta:{args:e}}}}getToolSchemas(){return[...this.tools.values()].map(t=>({name:t.name,description:t.description,parameters:Sr(t.schema),source:"frontend",mode:t.mode}))}},Xd(Lt.prototype,"getToolSchemas",[Ks],Object.getOwnPropertyDescriptor(Lt.prototype,"getToolSchemas"),Lt.prototype),Lt)([]);function fr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let i=s.target.result;if(e==="base64"){let o=i.slice(i.indexOf(",")+1);a(o)}else a(i)}}})}function eu(t){return Promise.all(t.map(e=>fr(e,"base64").then(a=>[e.name,a])))}var Js,Dt;function tu(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(i){n[i]=r[i]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(i,o){return o(t,e,i)||i},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}var Ct=class{async getAttachments(t){return[]}asURI(t){return`${this.contextType}://${t}`}parseContextIds(t){let e=RegExp(`${this.mentionPrefix}([\\w-]+):\\/\\/([\\w./-]+)`,"g"),a=[...t.matchAll(e)],r=n=>n.slice(1),s=a.filter(([,n])=>n===this.contextType).map(([n])=>r(n));return[...new Set(s)]}createBasicCompletion(t,e){return{label:`${this.mentionPrefix}${t.uri.split("://")[1]}`,displayLabel:t.name,detail:(e==null?void 0:e.detail)||t.description,boost:(e==null?void 0:e.boost)||1,type:(e==null?void 0:e.type)||this.contextType,apply:`${this.mentionPrefix}${t.uri}`,section:(e==null?void 0:e.section)||this.title}}};let au=(Js=Er(),Dt=class{constructor(){W(this,"providers",new Set)}register(t){return this.providers.add(t),this}getProviders(){return this.providers}getProvider(t){return[...this.providers].find(e=>e.contextType===t)}getAllItems(){return[...this.providers].flatMap(t=>t.getItems())}parseAllContextIds(t){return[...this.providers].flatMap(e=>e.parseContextIds(t))}getContextInfo(t){let e=[],a=new Map(this.getAllItems().map(r=>[r.uri,r]));for(let r of t){let s=a.get(r);s&&e.push(s)}return e}formatContextForAI(t){let e=new Map(this.getAllItems().map(r=>[r.uri,r])),a=[];for(let r of t){let s=e.get(r);s&&a.push(s)}return a.length===0?"":a.map(r=>{var s;return((s=this.getProvider(r.type))==null?void 0:s.formatContext(r))||""}).join(`

`)}async getAttachmentsForContext(t){let e=new Map(this.getAllItems().map(n=>[n.uri,n])),a=[];for(let n of t){let i=e.get(n);i&&a.push(i)}if(a.length===0)return[];let r=new vi;for(let n of a){let i=n.type;r.add(i,n)}let s=[...r.entries()].map(async([n,i])=>{let o=this.getProvider(n);if(!o)return[];try{return await o.getAttachments(i)}catch(l){return ce.error("Error getting attachments from provider",l),[]}});return(await Promise.all(s)).flat()}},tu(Dt.prototype,"getAllItems",[Js],Object.getOwnPropertyDescriptor(Dt.prototype,"getAllItems"),Dt.prototype),Dt);function Ys(t){return t.replaceAll("<","&lt;").replaceAll(">","&gt;")}function Et(t){let{type:e,data:a,details:r}=t,s=`<${e}`;for(let[n,i]of Object.entries(a))if(i!==void 0){let o=typeof i=="object"&&i?JSON.stringify(i):String(i),l=Ys(o);s+=` ${n}="${l}"`}return s+=">",r&&(s+=Ys(r)),s+=`</${e}>`,s}const mt={LOCAL_TABLE:7,REMOTE_TABLE:5,HIGH:4,MEDIUM:3,CELL_OUTPUT:2,LOW:2},ht={ERROR:{name:"Error",rank:1},TABLE:{name:"Table",rank:2},DATA_SOURCES:{name:"Data Sources",rank:3},VARIABLE:{name:"Variable",rank:4},CELL_OUTPUT:{name:"Cell Output",rank:5},FILE:{name:"File",rank:6}};function ru(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var su=class extends Ct{constructor(e){super();W(this,"title","Cell Outputs");W(this,"mentionPrefix","@");W(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(Kn),a=[];for(let[r,s]of e.cellIds.inOrderIds.entries()){let n=e.cellRuntime[s];if(!(n!=null&&n.output)||xi(n.output))continue;let i=e.cellData[s],o=n.output,l=o.mimetype,d=ru(l,String(o.data))?"media":"text",u=Vn(i.name,r),p,_,y=!1;d==="text"&&typeof o.data=="string"&&(p=l==="text/html"?Zi(o.data):o.data),d==="media"&&(typeof o.data=="string"&&o.data.startsWith("data:")||typeof o.data=="string"&&o.data.startsWith("http")?_=o.data:y=!0),a.push({uri:this.asURI(s),name:u,type:this.contextType,description:`Cell output (${l||"unknown"})`,data:{cellId:s,cellName:u,cellCode:(i==null?void 0:i.code)||"",output:o,outputType:d,processedContent:p,imageUrl:_,shouldDownloadImage:y}})}return a}formatCompletion(e){let{data:a}=e;return{label:`@${a.cellName}`,displayLabel:a.cellName,detail:`${a.outputType} output`,boost:a.outputType==="media"?mt.HIGH:mt.MEDIUM,type:this.contextType,section:ht.CELL_OUTPUT,apply:`@${a.cellName}`,info:()=>{let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");n.classList.add("font-bold","text-base"),n.textContent=a.cellName,s.append(n);let i=document.createElement("div");if(i.classList.add("text-sm","text-muted-foreground"),s.append(i),r.append(s),a.cellCode){let o=document.createElement("div");o.classList.add("text-xs","font-medium","text-muted-foreground"),o.textContent="Code:",r.append(o);let l=document.createElement("div");l.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),l.textContent=a.cellCode.slice(0,200)+(a.cellCode.length>200?"...":""),r.append(l)}if(a.processedContent){let o=document.createElement("div");o.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),o.textContent="Output Preview:",r.append(o);let l=document.createElement("div");l.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),l.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),r.append(l)}if(a.outputType==="media"){let o=document.createElement("div");o.classList.add("text-xs","text-muted-foreground","italic","mb-2"),o.textContent="A screenshot of the output will be attached",r.append(o)}return r}}}formatContext(e){let{data:a}=e,r={name:a.cellName,cellId:a.cellId,outputType:a.outputType,mimetype:a.output.mimetype},s=`Cell Code:
${a.cellCode}

`;return a.outputType==="text"&&a.processedContent?s+=`Output:
${a.processedContent}`:a.outputType==="media"&&(s+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(s+=`
Image URL: ${a.imageUrl}`)),Et({type:this.contextType,data:r,details:s})}async getAttachments(e){let a=e.filter(s=>s.data.shouldDownloadImage&&s.data.outputType==="media");if(a.length===0)return[];let r=a.flatMap(s=>{let n=document.getElementById(Fn.create(s.data.cellId));return n?{cellId:s.data.cellId,cellName:s.data.cellName,mimetype:s.data.output.mimetype,element:n}:(ce.warn(`Output element not found for cell ${s.data.cellId}`),[])});try{return await Promise.all(r.map(async s=>({type:"file",filename:`${s.cellName}-output-screenshot`,mediaType:"image/png",url:await ji(s.element)})))}catch(s){return ce.error("Error downloading cell output images:",s),[]}}},nu=et(Yn()),iu=class extends Ct{constructor(e,a){super();W(this,"title","Datasource");W(this,"mentionPrefix","@");W(this,"contextType","datasource");this.connectionsMap=e,this.dataframes=[...a.values()].filter(r=>xa(r)==="dataframe")}getItems(){return[...this.connectionsMap.values()].map(e=>{var s;let a="Database schema.",r={connection:e};return ba.has(e.name)&&(r.tables=this.dataframes,a="Database schema and the dataframes that can be queried"),e.databases.length===0&&(((s=r.tables)==null?void 0:s.length)??0)===0?null:{uri:this.asURI(e.name),name:e.name,description:a,type:this.contextType,data:r}}).filter(Boolean)}formatContext(e){let a=e.data,{name:r,display_name:s,source:n,...i}=a.connection,o=i;return ba.has(r)||(o={...i,engine_name:r}),Et({type:this.contextType,data:{connection:o,tables:a.tables}})}formatCompletion(e){let a=e.data,r=a.connection,s=a.tables,n=r.name;return ba.has(r.name)&&(n="In-Memory"),{label:`@${n}`,displayLabel:n,detail:Zn(r.dialect),boost:mt.MEDIUM,type:this.contextType,section:ht.DATA_SOURCES,info:()=>{let i=document.createElement("div");return i.classList.add("mo-cm-tooltip","docs-documentation"),(0,nu.createRoot)(i).render($n(r,s)),i}}}};function ou(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(Ri(t),"Unknown error")}var Hs=new Wn("error","errors"),lu=class extends Ct{constructor(e){super();W(this,"title","Errors");W(this,"mentionPrefix","@");W(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(Ln);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${Hs.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:ht.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${Hs.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:ht.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>Et({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>ou(s)).join(`
`)}})).join(`

`)}};const Gs=Dn();var du={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},uu=class extends Ct{constructor(e,a=du){super();W(this,"title","Files");W(this,"mentionPrefix","#");W(this,"contextType","file");W(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(i=>{let o={uri:this.asURI(i.path),name:i.name,type:this.contextType,description:i.isDirectory?"Directory":"File",data:{path:i.path,isDirectory:i.isDirectory}};return this.formatCompletion(o)});return{from:a.from,options:n}}catch(n){return ce.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let i={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(i)});return{from:e.from,options:s}}}catch(r){ce.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return ce.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:ht.FILE,boost:a.isDirectory?mt.MEDIUM:mt.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,i,o,l)=>{var x;let d=(x=n.state.facet(Gs))==null?void 0:x.addAttachment;if(!d){ce.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(f=>(jr({title:"Failed to get file details",description:f.message}),null));if(!u)return;let p=u.mimeType||"text/plain",_;if(p.startsWith("text/")||p.includes("json")||p.includes("xml"))_=new Blob([u.contents||""],{type:p});else if(u.contents)try{let f=wi(u.contents,p);_=await $i(f)}catch{_=new Blob([u.contents],{type:p})}else _=new Blob([""],{type:p});let y=new File([_],r,{type:p});d(y),n.dispatch({changes:{from:o,to:l,insert:""}}),hi(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let i=document.createElement("div");i.classList.add("font-bold"),i.textContent=r,n.append(i);let o=document.createElement("div");return o.classList.add("text-xs","text-muted-foreground"),o.textContent=a.path,n.append(o),n}}}formatContext(e){let{data:a,name:r}=e;return Et({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},cu=class extends Ct{constructor(e){super();W(this,"title","Tables");W(this,"mentionPrefix","@");W(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:i,name:o,variable_name:l}=a,d=[n==null?void 0:`${n} rows`,i==null?void 0:`${i} columns`].filter(Boolean).join(", "),u="";if(d&&(u+=`Shape: ${d}
`),l&&(u+=`Variable: ${l}
`),r&&r.length>0){u+=`Columns:
`;for(let p of r){let _=`  ${p.name} (${p.type})`;if(p.sample_values&&p.sample_values.length>0){let y=p.sample_values.slice(0,3).map(x=>x===null?"null":String(x)).join(", ");_+=` - samples: [${y}]`}u+=`${_}
`}}return Et({type:this.contextType,data:{name:o,source:s??"unknown"},details:u.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?mt.LOCAL_TABLE:mt.REMOTE_TABLE,type:xa(r),apply:`@${a}`,section:{name:xa(r)==="dataframe"?"Dataframe":"Table",rank:ht.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let o=document.createElement("div");o.classList.add("text-xs","text-muted-foreground"),o.textContent=`Source: ${a.source}`,s.append(o)}r.append(s);let i=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(i){let o=document.createElement("div");o.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),o.textContent=i,r.append(o)}if(a.columns&&a.columns.length>0){let o=document.createElement("div");o.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let d=l.insertRow();d.classList.add("bg-muted");let u=d.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let p=d.insertCell();p.classList.add("p-2","font-medium","text-left"),p.textContent="Type";let _=a.columns.some(x=>this.getItemMetadata(a,x)!==void 0),y;_&&(y=d.insertCell(),y.classList.add("p-2","font-medium","text-left"),y.textContent="Metadata"),a.columns.forEach((x,f)=>{let c=l.insertRow();c.classList.add(f%2==0?"bg-background":"bg-muted/30");let m=c.insertCell();m.classList.add("p-2","font-mono"),m.textContent=x.name;let b=c.insertCell();if(b.classList.add("p-2","text-muted-foreground"),b.textContent=x.type,_){let C=c.insertCell();C.classList.add("p-2");let A=this.getItemMetadata(a,x);A&&C.append(A)}}),o.append(l),r.append(o)}return r}getItemMetadata(e,a){var n,i;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(i=e.indexes)==null?void 0:i.includes(a.name);if(r||s){let o=document.createElement("span");o.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return o.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),o}}},pu=class extends Ct{constructor(e,a){super();W(this,"title","Variables");W(this,"mentionPrefix","@");W(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:ht.VARIABLE,info:()=>Bn(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return Et({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function ft(t){let e=t.get(Rn),a=t.get(jn),r=t.get(Mn);return new au().register(new cu(a)).register(new pu(r,a)).register(new lu(t)).register(new su(t)).register(new iu(e.connectionsMap,a))}function mu(){let t=pi();return new uu(t)}const hu="@";function fu({input:t}){let e="";return t.includes("@")&&(e=yu(t),ce.debug("Included context",e)),{includeOtherCode:Ir(""),context:{plainText:e,schema:[],variables:[]}}}async function gu({input:t}){let e="",a=[];if(t.includes("@")){let r=ft(Rr),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),ce.debug("Included attachments",a.length)}catch(n){ce.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Ir(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function yu(t){let e=ft(Rr),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function vu(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function _u(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),mi(t.current.view)}}function bu(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let d=t.slice(r+3),u=d.indexOf(" "),p=u===-1?d:d.slice(0,u),_=p==="markdown"?"markdown":p==="sql"?"sql":"python",y=u===-1?"":d.slice(u+1);y.trim()&&e.push({language:_,code:y.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let i=s+1,o=t.indexOf("```",i);if(o===-1){let d=t.slice(i).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d});break}let l=t.slice(i,o).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=o+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}function xu(t){return t.length>50?`${t.slice(0,50)}...`:t}async function wu(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await fr(e,"dataUrl")})))}function ku(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function Qs(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function Xs(t){let e=Qs(t.flatMap(s=>s.parts)),a=await gu({input:e});function r(s,n){let i=[...s.parts];return n&&i.push(...a.attachments),{role:s.role,content:Qs(s.parts),parts:i}}return{...a.body,messages:t.map((s,n)=>r(s,n===t.length-1))}}async function en({invokeAiTool:t,addToolResult:e,toolCall:a}){try{if(hr.has(a.toolName)){let r=await hr.invoke(a.toolName,a.input);e({tool:a.toolName,toolCallId:a.toolCallId,output:r})}else{let r=await t({toolName:a.toolName,arguments:a.input});e({tool:a.toolName,toolCallId:a.toolCallId,output:r.result||r.error})}}catch(r){ce.error("Tool call failed:",r),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${r instanceof Error?r.message:String(r)}`})}}function Tu(t){var i;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(o=>o.type.startsWith("tool-")).some(o=>o.state==="output-available"),s=a[a.length-1],n=s.type==="text"&&((i=s.text)==null?void 0:i.trim().length)>0;return r&&!n}function Cu(t){return ii.define({combine:e=>e[0]??t})}var tn=Cu({}),gr=Bt.define(),ga=Bt.define(),Eu=50,yr=Wt.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(ga)||n.is(gr))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(gr)){let i=n.value.trim();if(i){let o=t.prompts.filter(l=>l!==i);a.prompts=[i,...o].slice(0,Eu),(s=(r=e.state.facet(tn)).save)==null||s.call(r,a.prompts)}a.navigationIndex=-1,a.originalText=""}else n.is(ga)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),Iu=t=>{let e=t.state.field(yr),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:ga.of({index:r,originalText:s})}),!0},Su=t=>{let e=t.state.field(yr);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:ga.of({index:r,originalText:e.originalText})}),!0};const an=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:gr.of(e)}),!0):!1};function Au(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[yr.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),tn.of(e??{})];return a&&r.push(Ea.of([{key:"ArrowUp",run:Iu},{key:"ArrowDown",run:Su}])),r}var Ou=et(Ta()),rn=()=>new Set,{valueAtom:ya,useActions:Ru,createActions:Wc,reducer:qc}=ui(rn,{addStagedCell:(t,e)=>{let{cellId:a}=e;return new Set([...t,a])},removeStagedCell:(t,e)=>new Set([...t].filter(a=>a!==e)),clearStagedCells:()=>rn()});function sn(t){let e=(0,Ou.c)(26),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=Ru(),{createNewCell:n}=Nn(),i=Oi(),o=(0,N.useRef)(null),l;e[0]!==a||e[1]!==n?(l=C=>{let A=On.create();return a({cellId:A}),n({cellId:"__end__",code:C,before:!1,newCellId:A}),A},e[0]=a,e[1]=n,e[2]=l):l=e[2];let d=l,u;e[3]===t?u=e[4]:(u=C=>{var U,P;let{cellId:A,code:I}=C;if(!t.get(ya).has(A)){ce.error("Staged cell not found",{cellId:A});return}let j=(P=(U=t.get(zn(A)))==null?void 0:U.current)==null?void 0:P.editorViewOrNull;if(!j){ce.error("Editor for this cell not found",{cellId:A});return}Un(j,I)},e[3]=t,e[4]=u);let p=u,_;e[5]!==i||e[6]!==r?(_=C=>{r(C),i({cellId:C})},e[5]=i,e[6]=r,e[7]=_):_=e[7];let y=_,x;e[8]!==s||e[9]!==i||e[10]!==t?(x=()=>{let C=t.get(ya);for(let A of C)i({cellId:A});s()},e[8]=s,e[9]=i,e[10]=t,e[11]=x):x=e[11];let f=x,c;e[12]!==a||e[13]!==n||e[14]!==d||e[15]!==p?(c=C=>{e:switch(C.type){case"text-start":o.current=new Nu(d,p,a,n);break e;case"text-delta":if(!o.current){ce.error("Cell creation stream not found");return}o.current.stream(C);break e;case"text-end":case"finish":if(!o.current){ce.error("Cell creation stream not found");return}o.current.stop();break e;default:ce.error("Unknown chunk type",{chunk:C})}},e[12]=a,e[13]=n,e[14]=d,e[15]=p,e[16]=c):c=e[16];let m=c,b;return e[17]!==a||e[18]!==s||e[19]!==d||e[20]!==f||e[21]!==y||e[22]!==m||e[23]!==r||e[24]!==p?(b={createStagedCell:d,updateStagedCell:p,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:y,deleteAllStagedCells:f,onStream:m},e[17]=a,e[18]=s,e[19]=d,e[20]=f,e[21]=y,e[22]=m,e[23]=r,e[24]=p,e[25]=b):b=e[25],b}var Nu=class{constructor(t,e,a,r){W(this,"createdCells",[]);W(this,"buffer","");W(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=bu(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=Fi({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e}),this.hasMarimoImport=!0}stop(){this.buffer=""}};const vr=Bt.define(),Ye=Wt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(vr)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}}),Mu=Wt.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),Pu=Bt.define();Wt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Pu)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}});const ju=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=vr.of(new Map(s.map(o=>[o.uri,o])));a.view&&a.view.dispatch({effects:n});let i=s.map(o=>({label:`@${o.name}`,displayLabel:o.name,detail:o.uri,info:o.description||void 0,type:o.mimeType?"constant":"variable",boost:o.description?100:0,...e==null?void 0:e(o),apply:(l,d,u,p)=>{l.dispatch({changes:{from:u,to:p,insert:`@${o.uri} `}})}}));return{from:r.from,options:i}},Zu=/@[\w-]+:\/\/(?!\/)[^\s]+/;function ot(t){return t.matchAll(new RegExp(Zu.source,"g"))}var $u=class extends Pr{constructor(e,a){super();W(this,"resource");W(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(Mu,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",i=>{i.preventDefault(),i.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",i=>{i.preventDefault(),i.stopPropagation(),n(this.resource)}),e}},Lu=class extends Pr{constructor(e,a){super();W(this,"uri");W(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function nn(t){let e=t.state.field(Ye),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let i of ot(n)){let o=r+i.index,l=i[0].slice(1),d=e.get(l);d?a.push(Ca.replace({widget:new $u(d,t)}).range(o,o+i[0].length)):a.push(Ca.replace({widget:new Lu(l,t)}).range(o,o+i[0].length))}}return Ca.set(a)}const Du=di.fromClass(class{constructor(t){W(this,"decorations");this.decorations=nn(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(vr))))&&(this.decorations=nn(t.view))}},{decorations:t=>t.decorations});function Fu(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function zu(t,e,a,r=0){for(let s of ot(t)){let n=r+s.index,i=n+s[0].length;if(e>=n&&e<=i){let o=s[0].slice(1),l=a.get(o);if(l)return{resource:l,start:n,end:i}}}return null}function Uu(t){return li((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=e.state.field(Ye),i=zu(s,a,n,r);return i?{pos:i.start,end:i.end,above:!0,create(){return(t.createTooltip??Fu)(i.resource)}}:null})}function Vu(t,e){let a=t.field(Ye),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(ot(n));if(i.length===0)return null;for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(e===d&&a.has(u))return{from:l,to:d,uri:u}}return null}function Bu(t,e){let a=t.field(Ye),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),i=Array.from(ot(n));if(i.length===0)return null;let o=i[0];if(!o||o.index!==0)return null;let l=e,d=e+o[0].length,u=o[0].slice(1);return a.has(u)?{from:l,to:d,uri:u}:null}function on(t,e){let a=t.field(Ye),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(ot(n));for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(e>l&&e<d&&a.has(u))return{from:l,to:d,uri:u}}return null}function Wu(t,e){let a=t.field(Ye),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),i=Array.from(ot(n)),o=null;for(let l of i){let d=s.from+l.index,u=d+l[0].length,p=l[0].slice(1);a.has(p)&&u<=e&&(e>u?o=u:e===u&&(o=d))}return o}function qu(t,e){let a=t.field(Ye),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(ot(n));for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(a.has(u)&&l>=e){if(e<l)return l;if(e===l)return d}}return null}const Ku=si.transactionFilter.of(t=>{var r;let e=t.annotation(ni.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(Ye),n=t.startState.doc,i=!1,o=0,l=[];if(t.changes.iterChanges((d,u,p,_,y)=>{let x=y.toString(),f=d;if(/^\s+$/.test(x)){l.push({from:d,to:u,insert:x});return}let c=n.lineAt(f),m=n.sliceString(c.from,c.to),b=Array.from(ot(m)),C=!1,A=!1;for(let j of b){let U=c.from+j.index,P=U+j[0].length,X=j[0].slice(1);if(s.has(X)){if(f===U){let $=f>0?n.sliceString(f-1,f):"";$!==""&&$!==" "&&$!==`
`&&$!=="	"&&(C=!0)}if(f===P){let $=f<n.length?n.sliceString(f,f+1):"";($===""||$!==" "&&$!==`
`&&$!=="	")&&(A=!0)}}}let I=x;C&&(I=` ${I}`,o+=1),A&&(I=` ${I}`,o+=1),I!==x&&(i=!0),l.push({from:d,to:u,insert:I})}),i){let d=t.selection?{anchor:t.selection.main.anchor+o,head:t.selection.main.head+o}:void 0;return[{changes:l,selection:d,scrollIntoView:t.scrollIntoView}]}}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=Vu(t.startState,a.head):e==="delete.forward"&&(s=Bu(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,i=null;if(n<s){let o=on(t.startState,s);i=o&&s>o.from?o.from:Wu(t.startState,s)}else if(n>s){let o=on(t.startState,s);i=o&&s<o.to?o.to:qu(t.startState,s)}if(i!==null&&i!==n)return[{selection:{anchor:i},scrollIntoView:!0}]}return t}),Ju=Mr.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var ln="_none_",Yu=[{uri:"",name:"No resources",type:ln,data:{}}],Hu={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function Gu(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:ju(async()=>{let s=ft(a).getAllItems();return s.length===0?Yu:s},s=>{var n;return s.type===ln?Hu:((n=ft(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),Gs.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:mu().createCompletionSource()})]:[],Du,Ku,Ye.init(()=>{let s=ft(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),Ju,Uu({createTooltip:s=>{let n=ft(a).getProvider(s.type);if(!n)return ce.warn("No provider found for resource",s),Ft(s.description||s.name);let i=n.formatCompletion(s),o=s.description||s.name;if(!(i!=null&&i.info))return Ft(o);if(typeof i.info=="string")return Ft(i.info);let l=i.info(i);return l?"dom"in l?{dom:l.dom}:"then"in l?(ce.warn("info is a promise. This is not supported",l),Ft(o)):{dom:l}:Ft(o)}})]}function Ft(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var dn=et(Ta()),R=et(ti());const un=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let i=ai()?n.metaKey:n.ctrlKey;i&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&i&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},cn=t=>{let e=(0,dn.c)(22),{isLoading:a,onAccept:r,onDecline:s,size:n,acceptShortcut:i,declineShortcut:o,multipleCompletions:l}=t,d=n===void 0?"sm":n,u=i===void 0?"Mod-\u21B5":i,p=o===void 0?"Shift-Mod-Delete":o,_=l===void 0?!1:l,y=_&&" all",x;e[0]===u?x=e[1]:(x=(0,R.jsx)(Lr,{className:"ml-1 inline",shortcut:u}),e[0]=u,e[1]=x);let f;e[2]!==y||e[3]!==x?(f=(0,R.jsxs)("span",{className:"text-(--grass-11) opacity-100",children:["Accept",y," ",x]}),e[2]=y,e[3]=x,e[4]=f):f=e[4];let c;e[5]!==a||e[6]!==r||e[7]!==d||e[8]!==f?(c=(0,R.jsx)(tt,{"data-testid":"accept-completion-button",variant:"text",size:d,className:"mb-0",disabled:a,onClick:r,children:f}),e[5]=a,e[6]=r,e[7]=d,e[8]=f,e[9]=c):c=e[9];let m=_&&" all",b;e[10]===p?b=e[11]:(b=(0,R.jsx)(Lr,{className:"ml-1 inline",shortcut:p}),e[10]=p,e[11]=b);let C;e[12]!==b||e[13]!==m?(C=(0,R.jsxs)("span",{className:"text-(--red-10)",children:["Reject",m," ",b]}),e[12]=b,e[13]=m,e[14]=C):C=e[14];let A;e[15]!==s||e[16]!==d||e[17]!==C?(A=(0,R.jsx)(tt,{"data-testid":"decline-completion-button",variant:"text",size:d,className:"mb-0 pl-1 pr-0",onClick:s,children:C}),e[15]=s,e[16]=d,e[17]=C,e[18]=A):A=e[18];let I;return e[19]!==A||e[20]!==c?(I=(0,R.jsxs)(R.Fragment,{children:[c,A]}),e[19]=A,e[20]=c,e[21]=I):I=e[21],I},Qu=t=>{let e=(0,dn.c)(8),{isLoading:a,onAccept:r,onDecline:s}=t,n;e[0]!==a||e[1]!==r?(n=(0,R.jsx)(tt,{variant:"text",size:"xs",disabled:a,onClick:r,className:`h-6 text-(--grass-11) border-(--grass-7) bg-(--grass-3)/60
        hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) rounded px-3 font-semibold
        active:bg-(--grass-5) dark:active:bg-(--grass-4)
        border-(--green-6) border hover:shadow-xs`,children:"Accept"}),e[0]=a,e[1]=r,e[2]=n):n=e[2];let i;e[3]===s?i=e[4]:(i=(0,R.jsx)(tt,{variant:"text",size:"xs",onClick:s,className:`h-6 text-(--red-10) border-(--red-7) bg-(--red-3)/60 hover:bg-(--red-3)
        dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
        active:bg-(--red-5) dark:active:bg-(--red-4)
        border-(--red-6) border hover:shadow-xs`,children:"Reject"}),e[3]=s,e[4]=i);let o;return e[5]!==n||e[6]!==i?(o=(0,R.jsxs)(R.Fragment,{children:[n,i]}),e[5]=n,e[6]=i,e[7]=o):o=e[7],o};var Xu=class extends Ya{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},pn=et(Ta()),ec=qn("marimo:ai-language","python"),mn="marimo:ai-prompt-history",hn=new Jn(Be(h()),()=>[]);const tc=t=>{let e=(0,pn.c)(83),{onClose:a}=t,r=Cr(),[s,n]=(0,N.useState)(""),{deleteAllStagedCells:i,clearStagedCells:o,onStream:l}=sn(r),[d,u]=In(ec),p=ri(),{invokeAiTool:_}=ci(),y=Sn(ya),x=(0,N.useRef)(null),f;if(e[0]!==d||e[1]!==l||e[2]!==p){let xe;e[4]===d?xe=e[5]:(xe=async Ut=>{let kn=await Xs(Ut.messages);return{body:{...Ut,...kn,code:"",prompt:"",language:d}}},e[4]=d,e[5]=xe);let Ee;e[6]===l?Ee=e[7]:(Ee=Ut=>{l(Ut)},e[6]=l,e[7]=Ee),f=new Xu({api:p.getAiURL("completion").toString(),headers:p.headers(),prepareSendMessagesRequest:xe},Ee),e[0]=d,e[1]=l,e[2]=p,e[3]=f}else f=e[3];let{sendMessage:c,stop:m,status:b,addToolResult:C}=qs({experimental_throttle:100,transport:f,onToolCall:async xe=>{let{toolCall:Ee}=xe;await en({invokeAiTool:_,addToolResult:A,toolCall:{toolName:Ee.toolName,toolCallId:Ee.toolCallId,input:Ee.input}})},onError:ac}),A=C,I=b==="streaming"||b==="submitted",j=y.size>0,U=y.size>1,P;e[8]!==i||e[9]!==s||e[10]!==I||e[11]!==c?(P=()=>{var xe;I||((xe=x.current)!=null&&xe.view&&an(x.current.view),i(),c({text:s}))},e[8]=i,e[9]=s,e[10]=I,e[11]=c,e[12]=P):P=e[12];let X=P,$;e[13]===Symbol.for("react.memo_cache_sentinel")?($=(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(zi,{className:"size-4 mr-2"}),"Python"]}),e[13]=$):$=e[13];let oe=$,le;e[14]===Symbol.for("react.memo_cache_sentinel")?(le=(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(Pn,{className:"size-4 mr-2"}),"SQL"]}),e[14]=le):le=e[14];let ae=le,Y=d==="python"?oe:ae,he;e[15]===Symbol.for("react.memo_cache_sentinel")?(he=(0,R.jsx)(ki,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[15]=he):he=e[15];let J;e[16]===Y?J=e[17]:(J=(0,R.jsx)(Ci,{asChild:!0,children:(0,R.jsxs)(tt,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[Y,he]})}),e[16]=Y,e[17]=J);let q,H;e[18]===Symbol.for("react.memo_cache_sentinel")?(q=(0,R.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),H=(0,R.jsx)(Ti,{}),e[18]=q,e[19]=H):(q=e[18],H=e[19]);let Ae;e[20]===u?Ae=e[21]:(Ae=(0,R.jsx)($r,{onClick:()=>u("python"),children:oe}),e[20]=u,e[21]=Ae);let ve;e[22]===u?ve=e[23]:(ve=(0,R.jsx)($r,{onClick:()=>u("sql"),children:ae}),e[22]=u,e[23]=ve);let _e;e[24]!==Ae||e[25]!==ve?(_e=(0,R.jsxs)(Ei,{align:"center",children:[q,H,Ae,ve]}),e[24]=Ae,e[25]=ve,e[26]=_e):_e=e[26];let Te;e[27]!==_e||e[28]!==J?(Te=(0,R.jsxs)(Ii,{modal:!1,children:[J,_e]}),e[27]=_e,e[28]=J,e[29]=Te):Te=e[29];let He=Te,Ge;e[30]!==o||e[31]!==a?(Ge=()=>{o(),a()},e[30]=o,e[31]=a,e[32]=Ge):Ge=e[32];let Oe=Ge,lt;e[33]===i?lt=e[34]:(lt=()=>{i()},e[33]=i,e[34]=lt);let Fe=lt,gt;e[35]===Symbol.for("react.memo_cache_sentinel")?(gt=(0,R.jsx)(Ai,{className:"size-4 text-(--blue-11) mr-2"}),e[35]=gt):gt=e[35];let Qe;e[36]!==i||e[37]!==a?(Qe=()=>{i(),a()},e[36]=i,e[37]=a,e[38]=Qe):Qe=e[38];let Ze;e[39]===Symbol.for("react.memo_cache_sentinel")?(Ze=xe=>{n(xe)},e[39]=Ze):Ze=e[39];let ze;e[40]!==Oe||e[41]!==Fe||e[42]!==j||e[43]!==I?(ze=un({handleAcceptCompletion:Oe,handleDeclineCompletion:Fe,isLoading:I,hasCompletion:j}),e[40]=Oe,e[41]=Fe,e[42]=j,e[43]=I,e[44]=ze):ze=e[44];let V;e[45]!==s||e[46]!==X||e[47]!==Qe||e[48]!==ze?(V=(0,R.jsx)(fn,{inputRef:x,onClose:Qe,value:s,onChange:Ze,onSubmit:X,onKeyDown:ze}),e[45]=s,e[46]=X,e[47]=Qe,e[48]=ze,e[49]=V):V=e[49];let L;e[50]!==I||e[51]!==m?(L=I&&(0,R.jsxs)(tt,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:m,children:[(0,R.jsx)(Si,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[50]=I,e[51]=m,e[52]=L):L=e[52];let ee;e[53]===Symbol.for("react.memo_cache_sentinel")?(ee=(0,R.jsx)(Vi,{className:"size-4"}),e[53]=ee):ee=e[53];let B;e[54]===X?B=e[55]:(B=(0,R.jsx)(tt,{variant:"text",size:"sm",onClick:X,title:"Submit",children:ee}),e[54]=X,e[55]=B);let Ce;e[56]===Symbol.for("react.memo_cache_sentinel")?(Ce=(0,R.jsx)(bi,{className:"size-4"}),e[56]=Ce):Ce=e[56];let ge;e[57]===a?ge=e[58]:(ge=(0,R.jsx)(tt,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:Ce}),e[57]=a,e[58]=ge);let se;e[59]!==V||e[60]!==L||e[61]!==B||e[62]!==ge?(se=(0,R.jsxs)("div",{className:"flex items-center px-3",children:[gt,V,L,B,ge]}),e[59]=V,e[60]=L,e[61]=B,e[62]=ge,e[63]=se):se=e[63];let ne=se,be;e[64]===Symbol.for("react.memo_cache_sentinel")?(be=Nr("flex flex-col w-full gap-2 py-2"),e[64]=be):be=e[64];let Ue;e[65]===j?Ue=e[66]:(Ue=!j&&(0,R.jsxs)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1",children:[(0,R.jsxs)("span",{children:["You can mention"," ",(0,R.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,R.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names."]}),(0,R.jsx)("span",{children:"Code from other cells is automatically included."})]}),e[65]=j,e[66]=Ue);let Ve;e[67]!==Oe||e[68]!==Fe||e[69]!==j||e[70]!==I||e[71]!==U?(Ve=j&&(0,R.jsx)(cn,{isLoading:I,onAccept:Oe,onDecline:Fe,size:"sm",multipleCompletions:U}),e[67]=Oe,e[68]=Fe,e[69]=j,e[70]=I,e[71]=U,e[72]=Ve):Ve=e[72];let dt;e[73]===Symbol.for("react.memo_cache_sentinel")?(dt=(0,R.jsx)(_i,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[73]=dt):dt=e[73];let ie;e[74]===He?ie=e[75]:(ie=(0,R.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[He,dt]}),e[74]=He,e[75]=ie);let pe;e[76]!==Ue||e[77]!==Ve||e[78]!==ie?(pe=(0,R.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[Ue,Ve,ie]}),e[76]=Ue,e[77]=Ve,e[78]=ie,e[79]=pe):pe=e[79];let Xe;return e[80]!==ne||e[81]!==pe?(Xe=(0,R.jsxs)("div",{className:be,children:[ne,pe]}),e[80]=ne,e[81]=pe,e[82]=Xe):Xe=e[82],Xe},fn=t=>{let e=(0,pn.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:i,onSubmit:o,onKeyDown:l,onClose:d,onAddFiles:u,additionalCompletions:p,maxHeight:_}=t,y=o,x=d,f=Cr(),{theme:c}=yi(),m;e[0]===p?m=e[1]:(m=q=>p?vu([p.triggerCompletionRegex],p.completions)(q):null,e[0]=p,e[1]=m);let b=Mi(m),C,A,I,j;if(e[2]!==b||e[3]!==u||e[4]!==f){let q=gi();e[9]===Symbol.for("react.memo_cache_sentinel")?(C=fi({}),e[9]=C):C=e[9],A=q,I=Gu({language:q.language,store:f,onAddFiles:u}),j=q.language.data.of({autocomplete:b}),e[2]=b,e[3]=u,e[4]=f,e[5]=C,e[6]=A,e[7]=I,e[8]=j}else C=e[5],A=e[6],I=e[7],j=e[8];let U;e[10]===Symbol.for("react.memo_cache_sentinel")?(U=Au({storage:{load:rc,save:sc}}),e[10]=U):U=e[10];let P;e[11]===Symbol.for("react.memo_cache_sentinel")?(P=Li(),e[11]=P):P=e[11];let X;e[12]===y?X=e[13]:(X=oi.highest(Ea.of([{preventDefault:!0,stopPropagation:!0,any:(q,H)=>{let Ae=H.metaKey||H.ctrlKey||H.shiftKey;if(H.key==="Enter"&&!Ae)return y(H,q.state.doc.toString()),H.preventDefault(),H.stopPropagation(),!0;if(H.key==="Enter"&&H.shiftKey){let ve=q.state.selection.main.from;return q.dispatch({changes:{from:ve,to:ve,insert:`
`},selection:{anchor:ve+1,head:ve+1}}),H.preventDefault(),H.stopPropagation(),!0}return!1}}])),e[12]=y,e[13]=X);let $;e[14]===x?$=e[15]:($=Ea.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(x(),!0)}]),e[14]=x,e[15]=$);let oe;e[16]!==C||e[17]!==A||e[18]!==I||e[19]!==j||e[20]!==X||e[21]!==$?(oe=[C,A,I,j,U,Mr.lineWrapping,P,X,$],e[16]=C,e[17]=A,e[18]=I,e[19]=j,e[20]=X,e[21]=$,e[22]=oe):oe=e[22];let le=oe,ae;e[23]===n?ae=e[24]:(ae=Nr("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=ae);let Y=c==="dark"?"dark":"light",he=r||"Generate with AI, @ to include context",J;return e[25]!==le||e[26]!==s||e[27]!==_||e[28]!==i||e[29]!==l||e[30]!==ae||e[31]!==Y||e[32]!==he||e[33]!==a?(J=(0,R.jsx)(Di,{ref:s,className:ae,width:"100%",maxHeight:_,value:a,basicSetup:!1,extensions:le,onChange:i,onKeyDown:l,theme:Y,placeholder:he}),e[25]=le,e[26]=s,e[27]=_,e[28]=i,e[29]=l,e[30]=ae,e[31]=Y,e[32]=he,e[33]=a,e[34]=J):J=e[34],J};function ac(t){jr({title:"Generate with AI failed",description:Pi(t)})}function rc(){return hn.get(mn)}function sc(t){return hn.set(mn,t)}export{Qd as C,qs as S,Ui as T,fu as _,un as a,eu as b,an as c,xu as d,en as f,_u as g,hu as h,Qu as i,Xs as l,ku as m,fn as n,ya as o,Tu as p,cn as r,sn as s,tc as t,wu as u,ft as v,Ya as w,hr as x,fr as y};
