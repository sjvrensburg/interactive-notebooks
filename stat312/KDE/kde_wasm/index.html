<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>kde marimo</title>
    <script type="module" crossorigin src="./assets/index-CelXfcd8.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-CGDMlQfO.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="">import%20marimo%0A%0A__generated_with%20%3D%20%220.16.2%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%20Kernel%20Density%20Estimation%20(KDE)%3A%20Interactive%20Demonstration%0A%20%20%20%20%20%20%20%20%23%23%20Building%20Intuition%20Through%20Visual%20%22Bump%20Summing%22%0A%0A%20%20%20%20%20%20%20%20Welcome%20to%20this%20interactive%20exploration%20of%20**Kernel%20Density%20Estimation**!%20This%20notebook%20demonstrates%20how%20KDE%20builds%20smooth%20probability%20density%20functions%20by%20placing%20and%20summing%20%22bumps%22%20(kernels)%20at%20each%20data%20point.%0A%0A%20%20%20%20%20%20%20%20%23%23%20What%20is%20Kernel%20Density%20Estimation%3F%0A%0A%20%20%20%20%20%20%20%20KDE%20is%20a%20non-parametric%20method%20for%20estimating%20probability%20density%20functions.%20Instead%20of%20assuming%20a%20specific%20distribution%20shape%2C%20KDE%20lets%20the%20data%20speak%20for%20itself%20by%3A%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%8E%AF%20The%20Core%20Concept%3A**%0A%0A%20%20%20%20%20%20%20%20-%20Place%20a%20small%20%22bump%22%20(kernel%20function)%20at%20each%20data%20point%0A%20%20%20%20%20%20%20%20-%20Sum%20all%20these%20bumps%20together%20to%20form%20a%20smooth%20density%20curve%0A%20%20%20%20%20%20%20%20-%20Control%20the%20width%20of%20bumps%20with%20a%20bandwidth%20parameter%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%93%8A%20Mathematical%20Foundation%3A**%0A%0A%20%20%20%20%20%20%20%20The%20KDE%20formula%20is%3A%0A%20%20%20%20%20%20%20%20%24%24%5Chat%7Bf%7D(x)%20%3D%20%5Cfrac%7B1%7D%7Bnh%7D%20%5Csum_%7Bi%3D1%7D%5En%20K%5Cleft(%20%5Cfrac%7Bx%20-%20X_i%7D%7Bh%7D%20%5Cright)%24%24%0A%0A%20%20%20%20%20%20%20%20where%3A%0A%0A%20%20%20%20%20%20%20%20-%20%24%5Chat%7Bf%7D(x)%24%20is%20the%20estimated%20density%20at%20point%20%24x%24%0A%20%20%20%20%20%20%20%20-%20%24n%24%20is%20the%20number%20of%20data%20points%0A%20%20%20%20%20%20%20%20-%20%24h%24%20is%20the%20bandwidth%20(controls%20bump%20width)%0A%20%20%20%20%20%20%20%20-%20%24K(%5Ccdot)%24%20is%20the%20kernel%20function%20(shape%20of%20each%20bump)%0A%20%20%20%20%20%20%20%20-%20%24X_i%24%20are%20the%20observed%20data%20points%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%94%A7%20Key%20Features%3A**%0A%0A%20%20%20%20%20%20%20%20-%20**Bandwidth%20%24h%24**%3A%20Narrow%20%3D%20wiggly%20(follows%20data%20closely)%2C%20Wide%20%3D%20smooth%20(may%20miss%20features)%0A%20%20%20%20%20%20%20%20-%20**Kernel%20Choice**%3A%20Shape%20of%20individual%20bumps%20(Gaussian%2C%20Epanechnikov%2C%20etc.)%0A%20%20%20%20%20%20%20%20-%20**Normalisation**%3A%20Division%20by%20%24nh%24%20ensures%20total%20area%20%3D%201%20(valid%20probability%20density)%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Import%20required%20libraries%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20plotly.graph_objects%20as%20go%0A%20%20%20%20from%20plotly.subplots%20import%20make_subplots%0A%20%20%20%20import%20plotly.express%20as%20px%0A%20%20%20%20from%20scipy%20import%20stats%0A%20%20%20%20from%20scipy.integrate%20import%20quad%0A%20%20%20%20import%20pandas%20as%20pd%0A%0A%20%20%20%20%23%20Set%20random%20seed%20for%20reproducibility%0A%20%20%20%20np.random.seed(2025)%0A%20%20%20%20return%20go%2C%20make_subplots%2C%20np%2C%20quad%2C%20stats%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Sample%20Dataset%20Generation%0A%0A%20%20%20%20%20%20%20%20First%2C%20let's%20generate%20a%20sample%20dataset%20to%20demonstrate%20KDE%20concepts.%20You%20can%20experiment%20with%20different%20data%20patterns%20to%20see%20how%20KDE%20adapts.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20UI%20controls%20for%20data%20generation%0A%20%20%20%20sample_size_slider%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D20%2C%20stop%3D100%2C%20step%3D5%2C%20value%3D40%2C%0A%20%20%20%20%20%20%20%20label%3D%22Sample%20Size%20(n)%3A%22%0A%20%20%20%20)%0A%0A%20%20%20%20data_pattern_selector%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20options%3D%5B%22Bimodal%20Normal%22%2C%20%22Skewed%20Distribution%22%2C%20%22Uniform%20%2B%20Outliers%22%2C%20%22Single%20Normal%22%5D%2C%0A%20%20%20%20%20%20%20%20value%3D%22Bimodal%20Normal%22%2C%0A%20%20%20%20%20%20%20%20label%3D%22Data%20Pattern%3A%22%0A%20%20%20%20)%0A%0A%20%20%20%20regenerate_button%20%3D%20mo.ui.button(%0A%20%20%20%20%20%20%20%20value%3D0%2C%0A%20%20%20%20%20%20%20%20label%3D%22Regenerate%20Sample%20Data%22%0A%20%20%20%20)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Data%20Generation%20Controls%3A**%0A%0A%20%20%20%20%7Bsample_size_slider%7D%0A%20%20%20%20%7Bdata_pattern_selector%7D%0A%20%20%20%20%7Bregenerate_button%7D%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%20data_pattern_selector%2C%20regenerate_button%2C%20sample_size_slider%0A%0A%0A%40app.cell%0Adef%20_(data_pattern_selector%2C%20go%2C%20np%2C%20regenerate_button%2C%20sample_size_slider)%3A%0A%20%20%20%20%23%20Generate%20sample%20data%20based%20on%20user%20selections%0A%20%20%20%20%23%20Using%20regenerate_button.value%20as%20a%20trigger%20for%20reproducible%20randomness%0A%20%20%20%20_seed%20%3D%202025%20%2B%20regenerate_button.value%20*%2017%20%20%23%20Change%20seed%20when%20button%20clicked%0A%20%20%20%20np.random.seed(_seed)%0A%0A%20%20%20%20n_samples%20%3D%20sample_size_slider.value%0A%0A%20%20%20%20%23%20Generate%20data%20based%20on%20selected%20pattern%0A%20%20%20%20if%20data_pattern_selector.value%20%3D%3D%20%22Bimodal%20Normal%22%3A%0A%20%20%20%20%20%20%20%20%23%20Mixture%20of%20two%20normal%20distributions%0A%20%20%20%20%20%20%20%20_n1%20%3D%20n_samples%20%2F%2F%202%0A%20%20%20%20%20%20%20%20_n2%20%3D%20n_samples%20-%20_n1%0A%20%20%20%20%20%20%20%20sample_data%20%3D%20np.concatenate(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20np.random.normal(-2%2C%200.8%2C%20_n1)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20np.random.normal(2%2C%201.2%2C%20_n2)%0A%20%20%20%20%20%20%20%20%5D)%0A%20%20%20%20elif%20data_pattern_selector.value%20%3D%3D%20%22Skewed%20Distribution%22%3A%0A%20%20%20%20%20%20%20%20%23%20Exponential-like%20distribution%0A%20%20%20%20%20%20%20%20sample_data%20%3D%20np.random.gamma(2%2C%201%2C%20n_samples)%20-%201%0A%20%20%20%20elif%20data_pattern_selector.value%20%3D%3D%20%22Uniform%20%2B%20Outliers%22%3A%0A%20%20%20%20%20%20%20%20%23%20Uniform%20with%20some%20outliers%0A%20%20%20%20%20%20%20%20_main_data%20%3D%20np.random.uniform(-3%2C%203%2C%20int(0.9%20*%20n_samples))%0A%20%20%20%20%20%20%20%20_outliers%20%3D%20np.random.choice(%5B-8%2C%208%5D%2C%20int(0.1%20*%20n_samples))%0A%20%20%20%20%20%20%20%20sample_data%20%3D%20np.concatenate(%5B_main_data%2C%20_outliers%5D)%0A%20%20%20%20else%3A%20%20%23%20Single%20Normal%0A%20%20%20%20%20%20%20%20sample_data%20%3D%20np.random.normal(0%2C%201.5%2C%20n_samples)%0A%0A%20%20%20%20%23%20Create%20initial%20data%20visualization%0A%20%20%20%20data_fig%20%3D%20go.Figure()%0A%0A%20%20%20%20%23%20Add%20sample%20points%20as%20rug%20plot%20at%20y%3D0%0A%20%20%20%20data_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20x%3Dsample_data%2C%0A%20%20%20%20%20%20%20%20y%3Dnp.zeros(len(sample_data))%2C%0A%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20marker%3Ddict(%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3D'darkblue'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20size%3D8%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20opacity%3D0.8%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20symbol%3D'line-ns'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(width%3D2)%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20name%3Df'Sample%20Data%20(n%3D%7Blen(sample_data)%7D)'%2C%0A%20%20%20%20%20%20%20%20hovertemplate%3D'Data%20Point%3A%20%25%7Bx%3A.2f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20))%0A%0A%20%20%20%20data_fig.update_layout(%0A%20%20%20%20%20%20%20%20title%3Df'Sample%20Dataset%3A%20%7Bdata_pattern_selector.value%7D%20(n%3D%7Blen(sample_data)%7D)'%2C%0A%20%20%20%20%20%20%20%20xaxis_title%3D'x'%2C%0A%20%20%20%20%20%20%20%20yaxis_title%3D''%2C%0A%20%20%20%20%20%20%20%20yaxis%3Ddict(showticklabels%3DFalse%2C%20range%3D%5B-0.5%2C%200.5%5D)%2C%0A%20%20%20%20%20%20%20%20height%3D300%2C%0A%20%20%20%20%20%20%20%20showlegend%3DTrue%0A%20%20%20%20)%0A%20%20%20%20return%20(sample_data%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Kernel%20Functions%0A%0A%20%20%20%20%20%20%20%20Different%20kernel%20functions%20create%20different%20%22bump%22%20shapes.%20Let's%20explore%20the%20most%20common%20kernels%20used%20in%20practice.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(np%2C%20stats)%3A%0A%20%20%20%20%23%20Define%20kernel%20functions%0A%20%20%20%20def%20gaussian_kernel(u)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Standard%20Gaussian%20kernel%3A%20K(u)%20%3D%20(1%2F%E2%88%9A(2%CF%80))%20*%20exp(-u%C2%B2%2F2)%22%22%22%0A%20%20%20%20%20%20%20%20return%20stats.norm.pdf(u)%0A%0A%20%20%20%20def%20epanechnikov_kernel(u)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Epanechnikov%20kernel%3A%20K(u)%20%3D%20(3%2F4)(1-u%C2%B2)%20for%20%7Cu%7C%20%E2%89%A4%201%22%22%22%0A%20%20%20%20%20%20%20%20return%20np.where(np.abs(u)%20%3C%3D%201%2C%200.75%20*%20(1%20-%20u**2)%2C%200)%0A%0A%20%20%20%20def%20triangular_kernel(u)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Triangular%20kernel%3A%20K(u)%20%3D%20(1-%7Cu%7C)%20for%20%7Cu%7C%20%E2%89%A4%201%22%22%22%0A%20%20%20%20%20%20%20%20return%20np.where(np.abs(u)%20%3C%3D%201%2C%201%20-%20np.abs(u)%2C%200)%0A%0A%20%20%20%20def%20uniform_kernel(u)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Uniform%20(rectangular)%20kernel%3A%20K(u)%20%3D%201%2F2%20for%20%7Cu%7C%20%E2%89%A4%201%22%22%22%0A%20%20%20%20%20%20%20%20return%20np.where(np.abs(u)%20%3C%3D%201%2C%200.5%2C%200)%0A%0A%20%20%20%20%23%20Dictionary%20of%20available%20kernels%20with%20descriptions%0A%20%20%20%20kernel_functions%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'Gaussian'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'func'%3A%20gaussian_kernel%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'desc'%3A%20'Smooth%2C%20bell-shaped%20bumps%20(most%20common)'%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20'Epanechnikov'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'func'%3A%20epanechnikov_kernel%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'desc'%3A%20'Parabola-shaped%2C%20theoretically%20optimal'%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20'Triangular'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'func'%3A%20triangular_kernel%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'desc'%3A%20'Triangle-shaped%20with%20finite%20support'%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20'Uniform'%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'func'%3A%20uniform_kernel%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'desc'%3A%20'Rectangular%20bumps%20(like%20histogram%20bins)'%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20return%20(kernel_functions%2C)%0A%0A%0A%40app.cell%0Adef%20_(go%2C%20kernel_functions%2C%20np)%3A%0A%20%20%20%20%23%20Visualise%20kernel%20functions%0A%20%20%20%20u_vals%20%3D%20np.linspace(-3%2C%203%2C%20500)%0A%0A%20%20%20%20kernel_comparison_fig%20%3D%20go.Figure()%0A%0A%20%20%20%20_colors%20%3D%20%5B'blue'%2C%20'red'%2C%20'green'%2C%20'orange'%5D%0A%20%20%20%20for%20_i%2C%20(_kernel_name%2C%20_kernel_info)%20in%20enumerate(kernel_functions.items())%3A%0A%20%20%20%20%20%20%20%20_kernel_vals%20%3D%20_kernel_info%5B'func'%5D(u_vals)%0A%20%20%20%20%20%20%20%20kernel_comparison_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Du_vals%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3D_kernel_vals%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(width%3D3%2C%20color%3D_colors%5B_i%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3Df'%7B_kernel_name%7D'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3Df'%7B_kernel_name%7D%20Kernel%3Cbr%3Eu%3A%20%25%7B%7Bx%3A.2f%7D%7D%3Cbr%3EK(u)%3A%20%25%7B%7By%3A.3f%7D%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20))%0A%0A%20%20%20%20kernel_comparison_fig.update_layout(%0A%20%20%20%20%20%20%20%20title%3D'Kernel%20Function%20Comparison'%2C%0A%20%20%20%20%20%20%20%20xaxis_title%3D'u%20(standardised%20distance)'%2C%0A%20%20%20%20%20%20%20%20yaxis_title%3D'K(u)%20(kernel%20weight)'%2C%0A%20%20%20%20%20%20%20%20width%3D800%2C%0A%20%20%20%20%20%20%20%20height%3D500%2C%0A%20%20%20%20%20%20%20%20showlegend%3DTrue%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Interactive%20KDE%20Construction%0A%0A%20%20%20%20%20%20%20%20Now%20let's%20build%20a%20KDE%20step-by-step!%20The%20plot%20defaults%20to%20the%20**normalised%20scale**%2C%20which%20makes%20it%20much%20easier%20to%20see%20how%20individual%20shaded%20kernel%20%22bumps%22%20contribute%20to%20the%20final%20density%20curve.%20The%20dual%20y-axis%20allows%20comparison%20between%20normalised%20density%20and%20the%20raw%20unnormalised%20sum.%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%92%A1%20Why%20Normalised%20Scale%3F**%20On%20this%20scale%2C%20individual%20kernels%20are%20clearly%20visible%20and%20their%20contributions%20to%20the%20final%20KDE%20are%20easy%20to%20understand.%20The%20unnormalised%20sum%20can%20make%20individual%20bumps%20appear%20tiny%20relative%20to%20the%20main%20curve.%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%8E%A8%20Colorblind-Safe%20Design%3A**%20Each%20kernel%20%22bump%22%20uses%20a%20different%20colour%20from%20a%20colorblind-friendly%20palette%2C%20making%20it%20easy%20to%20distinguish%20individual%20contributions%20even%20when%20they%20overlap.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(kernel_functions%2C%20mo)%3A%0A%20%20%20%20%23%20UI%20controls%20for%20KDE%20parameters%0A%20%20%20%20kernel_selector%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20options%3Dlist(kernel_functions.keys())%2C%0A%20%20%20%20%20%20%20%20value%3D'Gaussian'%2C%0A%20%20%20%20%20%20%20%20label%3D'Kernel%20Function%3A'%0A%20%20%20%20)%0A%0A%20%20%20%20bandwidth_slider%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.2%2C%20stop%3D3.0%2C%20step%3D0.1%2C%20value%3D0.8%2C%0A%20%20%20%20%20%20%20%20label%3D'Bandwidth%20(h)%3A'%0A%20%20%20%20)%0A%0A%20%20%20%20show_individual_kernels%20%3D%20mo.ui.checkbox(%0A%20%20%20%20%20%20%20%20value%3DTrue%2C%0A%20%20%20%20%20%20%20%20label%3D'Show%20Individual%20Kernels%20(Shaded%20Bumps)'%0A%20%20%20%20)%0A%0A%20%20%20%20display_mode%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20options%3D%5B%22Normalised%20KDE%22%2C%20%22Unnormalised%20Sum%22%5D%2C%0A%20%20%20%20%20%20%20%20value%3D%22Normalised%20KDE%22%2C%0A%20%20%20%20%20%20%20%20label%3D'Display%20Mode%3A'%0A%20%20%20%20)%0A%0A%20%20%20%20highlight_point_slider%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D-5%2C%20stop%3D5%2C%20step%3D0.1%2C%20value%3D0.0%2C%0A%20%20%20%20%20%20%20%20label%3D'Highlight%20Point%20(x)%3A'%0A%20%20%20%20)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**KDE%20Construction%20Parameters%3A**%0A%0A%20%20%20%20%7Bkernel_selector%7D%0A%20%20%20%20%7Bbandwidth_slider%7D%0A%0A%20%20%20%20**Visualisation%20Options%3A**%0A%20%20%20%20%7Bdisplay_mode%7D%0A%20%20%20%20%7Bshow_individual_kernels%7D%0A%0A%20%20%20%20**Interactive%20Exploration%3A**%0A%20%20%20%20%7Bhighlight_point_slider%7D%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20bandwidth_slider%2C%0A%20%20%20%20%20%20%20%20display_mode%2C%0A%20%20%20%20%20%20%20%20highlight_point_slider%2C%0A%20%20%20%20%20%20%20%20kernel_selector%2C%0A%20%20%20%20%20%20%20%20show_individual_kernels%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20bandwidth_slider%2C%0A%20%20%20%20display_mode%2C%0A%20%20%20%20go%2C%0A%20%20%20%20highlight_point_slider%2C%0A%20%20%20%20kernel_functions%2C%0A%20%20%20%20kernel_selector%2C%0A%20%20%20%20make_subplots%2C%0A%20%20%20%20np%2C%0A%20%20%20%20sample_data%2C%0A%20%20%20%20show_individual_kernels%2C%0A)%3A%0A%20%20%20%20%23%20Build%20KDE%20step%20by%20step%0A%20%20%20%20selected_kernel%20%3D%20kernel_functions%5Bkernel_selector.value%5D%5B'func'%5D%0A%20%20%20%20bandwidth%20%3D%20bandwidth_slider.value%0A%20%20%20%20highlight_x%20%3D%20highlight_point_slider.value%0A%0A%20%20%20%20%23%20Create%20evaluation%20grid%0A%20%20%20%20x_min%2C%20x_max%20%3D%20np.min(sample_data)%20-%203%2C%20np.max(sample_data)%20%2B%203%0A%20%20%20%20x_grid%20%3D%20np.linspace(x_min%2C%20x_max%2C%20500)%0A%0A%20%20%20%20%23%20Calculate%20individual%20kernels%20and%20their%20sum%0A%20%20%20%20individual_kernels%20%3D%20%5B%5D%0A%20%20%20%20kernel_sum%20%3D%20np.zeros_like(x_grid)%0A%0A%20%20%20%20for%20_i%2C%20_xi%20in%20enumerate(sample_data)%3A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20kernel%20centred%20at%20data%20point%20_xi%0A%20%20%20%20%20%20%20%20_kernel_vals%20%3D%20selected_kernel((x_grid%20-%20_xi)%20%2F%20bandwidth)%0A%20%20%20%20%20%20%20%20individual_kernels.append(_kernel_vals)%0A%20%20%20%20%20%20%20%20kernel_sum%20%2B%3D%20_kernel_vals%0A%0A%20%20%20%20%23%20Final%20KDE%20(normalised)%0A%20%20%20%20kde_estimate%20%3D%20kernel_sum%20%2F%20(len(sample_data)%20*%20bandwidth)%0A%0A%20%20%20%20%23%20Determine%20which%20curve%20to%20display%20and%20calculate%20y-axis%20scales%0A%20%20%20%20if%20display_mode.value%20%3D%3D%20%22Unnormalised%20Sum%22%3A%0A%20%20%20%20%20%20%20%20primary_curve%20%3D%20kernel_sum%0A%20%20%20%20%20%20%20%20primary_label%20%3D%20'Sum%20of%20Kernels'%0A%20%20%20%20%20%20%20%20primary_color%20%3D%20'orange'%0A%20%20%20%20%20%20%20%20%23%20Secondary%20axis%20shows%20normalised%20scale%0A%20%20%20%20%20%20%20%20normalisation_factor%20%3D%20len(sample_data)%20*%20bandwidth%0A%20%20%20%20else%3A%20%20%23%20Normalised%20KDE%0A%20%20%20%20%20%20%20%20primary_curve%20%3D%20kde_estimate%0A%20%20%20%20%20%20%20%20primary_label%20%3D%20'Normalised%20KDE'%0A%20%20%20%20%20%20%20%20primary_color%20%3D%20'red'%0A%20%20%20%20%20%20%20%20%23%20Secondary%20axis%20shows%20unnormalised%20scale%0A%20%20%20%20%20%20%20%20normalisation_factor%20%3D%201.0%20%2F%20(len(sample_data)%20*%20bandwidth)%0A%0A%20%20%20%20%23%20Create%20subplot%20with%20secondary%20y-axis%0A%20%20%20%20kde_construction_fig%20%3D%20make_subplots(specs%3D%5B%5B%7B%22secondary_y%22%3A%20True%7D%5D%5D)%0A%0A%20%20%20%20%23%20Add%20sample%20data%20points%0A%20%20%20%20kde_construction_fig.add_trace(%0A%20%20%20%20%20%20%20%20go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dsample_data%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dnp.zeros(len(sample_data))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'black'%2C%20size%3D10%2C%20symbol%3D'line-ns'%2C%20line%3Ddict(width%3D3))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3D'Sample%20Data%20Points'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3D'Data%20Point%3A%20%25%7Bx%3A.2f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20secondary_y%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Show%20individual%20kernels%20with%20shaded%20areas%20if%20requested%0A%20%20%20%20if%20show_individual_kernels.value%3A%0A%20%20%20%20%20%20%20%20%23%20Colorblind-safe%20palette%20-%20each%20color%20has%20both%20fill%20(with%20transparency)%20and%20line%20versions%0A%20%20%20%20%20%20%20%20_kernel_palette%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(31%2C119%2C180%2C0.4)'%2C%20'line'%3A%20'rgb(31%2C119%2C180)'%7D%2C%20%20%20%20%20%20%23%20Blue%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(255%2C127%2C14%2C0.4)'%2C%20'line'%3A%20'rgb(255%2C127%2C14)'%7D%2C%20%20%20%20%20%20%23%20Orange%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(44%2C160%2C44%2C0.4)'%2C%20'line'%3A%20'rgb(44%2C160%2C44)'%7D%2C%20%20%20%20%20%20%20%20%23%20Green%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(214%2C39%2C40%2C0.4)'%2C%20'line'%3A%20'rgb(214%2C39%2C40)'%7D%2C%20%20%20%20%20%20%20%20%23%20Red%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(148%2C103%2C189%2C0.4)'%2C%20'line'%3A%20'rgb(148%2C103%2C189)'%7D%2C%20%20%20%20%23%20Purple%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(140%2C86%2C75%2C0.4)'%2C%20'line'%3A%20'rgb(140%2C86%2C75)'%7D%2C%20%20%20%20%20%20%20%20%23%20Brown%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(227%2C119%2C194%2C0.4)'%2C%20'line'%3A%20'rgb(227%2C119%2C194)'%7D%2C%20%20%20%20%23%20Pink%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B'fill'%3A%20'rgba(127%2C127%2C127%2C0.4)'%2C%20'line'%3A%20'rgb(127%2C127%2C127)'%7D%20%20%20%20%20%23%20Grey%0A%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20for%20_i%2C%20(_xi%2C%20_kernel_vals)%20in%20enumerate(zip(sample_data%2C%20individual_kernels))%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Scale%20kernel%20values%20to%20match%20display%20mode%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20display_mode.value%20%3D%3D%20%22Normalised%20KDE%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_display_kernel_vals%20%3D%20_kernel_vals%20%2F%20(len(sample_data)%20*%20bandwidth)%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_display_kernel_vals%20%3D%20_kernel_vals%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Cycle%20through%20colors%20using%20modulo%0A%20%20%20%20%20%20%20%20%20%20%20%20_color_idx%20%3D%20_i%20%25%20len(_kernel_palette)%0A%20%20%20%20%20%20%20%20%20%20%20%20_fill_color%20%3D%20_kernel_palette%5B_color_idx%5D%5B'fill'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20_line_color%20%3D%20_kernel_palette%5B_color_idx%5D%5B'line'%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Add%20shaded%20area%20under%20each%20kernel%20with%20alternating%20colors%0A%20%20%20%20%20%20%20%20%20%20%20%20kde_construction_fig.add_trace(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Dx_grid%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3D_display_kernel_vals%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(width%3D1.5%2C%20color%3D_line_color)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fill%3D'tozeroy'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fillcolor%3D_fill_color%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%3D'Individual%20Kernels'%20if%20_i%20%3D%3D%200%20else%20''%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20showlegend%3D(_i%20%3D%3D%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3Df'Kernel%20%7B_i%2B1%7D%20at%20x%3D%7B_xi%3A.2f%7D%3Cbr%3EHeight%3A%20%25%7B%7By%3A.3f%7D%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20secondary_y%3DFalse%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%23%20Add%20the%20primary%20curve%0A%20%20%20%20kde_construction_fig.add_trace(%0A%20%20%20%20%20%20%20%20go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dx_grid%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dprimary_curve%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(width%3D4%2C%20color%3Dprimary_color)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3Dprimary_label%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3Df'%7Bprimary_label%7D%3A%20%25%7B%7By%3A.3f%7D%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20secondary_y%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Highlight%20specific%20point%20and%20show%20calculation%0A%20%20%20%20_highlight_idx%20%3D%20np.argmin(np.abs(x_grid%20-%20highlight_x))%0A%20%20%20%20_highlight_primary_val%20%3D%20primary_curve%5B_highlight_idx%5D%0A%0A%20%20%20%20kde_construction_fig.add_trace(%0A%20%20%20%20%20%20%20%20go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3D%5Bhighlight_x%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3D%5B_highlight_primary_val%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'purple'%2C%20size%3D15%2C%20symbol%3D'star')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3Df'Query%20Point%20(x%3D%7Bhighlight_x%3A.1f%7D)'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3Df'x%3D%7Bhighlight_x%3A.1f%7D%3Cbr%3E%7Bprimary_label%7D%3D%7B_highlight_primary_val%3A.3f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20secondary_y%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Add%20vertical%20line%20at%20highlight%20point%0A%20%20%20%20kde_construction_fig.add_vline(%0A%20%20%20%20%20%20%20%20x%3Dhighlight_x%2C%0A%20%20%20%20%20%20%20%20line%3Ddict(color%3D%22purple%22%2C%20dash%3D%22dash%22%2C%20width%3D2)%2C%0A%20%20%20%20%20%20%20%20opacity%3D0.7%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Set%20x-axis%20properties%0A%20%20%20%20kde_construction_fig.update_xaxes(title_text%3D%22x%22)%0A%0A%20%20%20%20%23%20Set%20y-axes%20properties%0A%20%20%20%20if%20display_mode.value%20%3D%3D%20%22Unnormalised%20Sum%22%3A%0A%20%20%20%20%20%20%20%20kde_construction_fig.update_yaxes(title_text%3D%22Unnormalised%20Sum%22%2C%20secondary_y%3DFalse)%0A%20%20%20%20%20%20%20%20kde_construction_fig.update_yaxes(title_text%3D%22Normalised%20Density%22%2C%20secondary_y%3DTrue)%0A%20%20%20%20%20%20%20%20%23%20Set%20secondary%20y-axis%20range%20to%20show%20normalised%20scale%0A%20%20%20%20%20%20%20%20_max_primary%20%3D%20np.max(primary_curve)%0A%20%20%20%20%20%20%20%20kde_construction_fig.update_yaxes(%0A%20%20%20%20%20%20%20%20%20%20%20%20range%3D%5B0%2C%20_max_primary%20%2F%20normalisation_factor%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20secondary_y%3DTrue%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20else%3A%20%20%23%20Normalised%20KDE%0A%20%20%20%20%20%20%20%20kde_construction_fig.update_yaxes(title_text%3D%22Normalised%20Density%22%2C%20secondary_y%3DFalse)%0A%20%20%20%20%20%20%20%20kde_construction_fig.update_yaxes(title_text%3D%22Unnormalised%20Sum%22%2C%20secondary_y%3DTrue)%0A%20%20%20%20%20%20%20%20%23%20Set%20secondary%20y-axis%20range%20to%20show%20unnormalised%20scale%0A%20%20%20%20%20%20%20%20_max_primary%20%3D%20np.max(primary_curve)%0A%20%20%20%20%20%20%20%20kde_construction_fig.update_yaxes(%0A%20%20%20%20%20%20%20%20%20%20%20%20range%3D%5B0%2C%20_max_primary%20*%20len(sample_data)%20*%20bandwidth%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20secondary_y%3DTrue%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20kde_construction_fig.update_layout(%0A%20%20%20%20%20%20%20%20title%3Df'KDE%20Construction%3A%20%7Bkernel_selector.value%7D%20Kernel%20(h%3D%7Bbandwidth%3A.1f%7D)%20-%20%7Bdisplay_mode.value%7D'%2C%0A%20%20%20%20%20%20%20%20width%3D1000%2C%0A%20%20%20%20%20%20%20%20height%3D600%2C%0A%20%20%20%20%20%20%20%20showlegend%3DTrue%0A%20%20%20%20)%0A%20%20%20%20return%20bandwidth%2C%20kde_estimate%2C%20selected_kernel%2C%20x_grid%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20bandwidth%2C%0A%20%20%20%20highlight_point_slider%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20np%2C%0A%20%20%20%20sample_data%2C%0A%20%20%20%20selected_kernel%2C%0A%20%20%20%20x_grid%2C%0A)%3A%0A%20%20%20%20%23%20Calculate%20and%20display%20the%20mathematical%20breakdown%20at%20the%20highlight%20point%0A%20%20%20%20highlight_x_val%20%3D%20highlight_point_slider.value%0A%0A%20%20%20%20%23%20Find%20the%20closest%20grid%20point%20for%20calculation%0A%20%20%20%20_highlight_idx%20%3D%20np.argmin(np.abs(x_grid%20-%20highlight_x_val))%0A%20%20%20%20_x_eval%20%3D%20x_grid%5B_highlight_idx%5D%0A%0A%20%20%20%20%23%20Calculate%20individual%20contributions%0A%20%20%20%20_contributions%20%3D%20%5B%5D%0A%20%20%20%20_total_kernel_sum%20%3D%200%0A%0A%20%20%20%20for%20_i%2C%20_xi%20in%20enumerate(sample_data)%3A%0A%20%20%20%20%20%20%20%20_u%20%3D%20(_x_eval%20-%20_xi)%20%2F%20bandwidth%0A%20%20%20%20%20%20%20%20_kernel_val%20%3D%20selected_kernel(_u)%0A%20%20%20%20%20%20%20%20_contributions.append(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'data_point'%3A%20_xi%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'standardised_distance'%3A%20_u%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'kernel_value'%3A%20_kernel_val%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20_total_kernel_sum%20%2B%3D%20_kernel_val%0A%0A%20%20%20%20%23%20Final%20KDE%20value%0A%20%20%20%20_final_kde%20%3D%20_total_kernel_sum%20%2F%20(len(sample_data)%20*%20bandwidth)%0A%0A%20%20%20%20%23%20Create%20summary%20text%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20%23%23%20Mathematical%20Breakdown%20at%20x%20%3D%20%7B_x_eval%3A.2f%7D%0A%0A%20%20%20%20**Step-by-step%20KDE%20Calculation%3A**%0A%0A%20%20%20%201.%20**Individual%20Kernel%20Contributions%3A**%0A%20%20%20%20%20%20%20-%20For%20each%20data%20point%20%24X_i%24%2C%20calculate%20standardised%20distance%3A%20%24u_i%20%3D%20%5C%5Cfrac%7B%7Bx%20-%20X_i%7D%7D%7B%7Bh%7D%7D%20%3D%20%5C%5Cfrac%7B%7B%7B_x_eval%3A.2f%7D%20-%20X_i%7D%7D%7B%7B%7Bbandwidth%3A.1f%7D%7D%7D%24%0A%20%20%20%20%20%20%20-%20Apply%20kernel%20function%3A%20%24K(u_i)%24%0A%0A%20%20%20%202.%20**Sum%20of%20All%20Kernels%3A**%20%24%5C%5Csum_%7B%7Bi%3D1%7D%7D%5En%20K(u_i)%20%3D%20%7B_total_kernel_sum%3A.3f%7D%24%0A%0A%20%20%20%203.%20**Final%20KDE%20Value%3A**%20%24%5C%5Chat%7B%7Bf%7D%7D(x)%20%3D%20%5C%5Cfrac%7B%7B1%7D%7D%7B%7Bnh%7D%7D%20%5C%5Csum_%7B%7Bi%3D1%7D%7D%5En%20K(u_i)%20%3D%20%5C%5Cfrac%7B%7B%7B_total_kernel_sum%3A.3f%7D%7D%7D%7B%7B%7Blen(sample_data)%7D%20%5C%5Ctimes%20%7Bbandwidth%3A.1f%7D%7D%7D%20%3D%20%7B_final_kde%3A.3f%7D%24%0A%0A%20%20%20%20**Parameters%3A**%0A%20%20%20%20-%20Sample%20size%20(n)%3A%20%7Blen(sample_data)%7D%0A%20%20%20%20-%20Bandwidth%20(h)%3A%20%7Bbandwidth%3A.1f%7D%0A%20%20%20%20-%20Normalisation%20factor%20(nh)%3A%20%7Blen(sample_data)%20*%20bandwidth%3A.1f%7D%0A%0A%20%20%20%20**Note%3A**%20The%20normalisation%20by%20%24nh%24%20ensures%20the%20total%20area%20under%20the%20KDE%20equals%201%2C%20making%20it%20a%20valid%20probability%20density%20function.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Area%20Verification%3A%20Ensuring%20Valid%20Probability%20Density%0A%0A%20%20%20%20%20%20%20%20A%20fundamental%20property%20of%20probability%20density%20functions%20is%20that%20the%20total%20area%20under%20the%20curve%20must%20equal%201.%20Let's%20verify%20this%20for%20our%20KDE%20estimate.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(go%2C%20kde_estimate%2C%20np%2C%20quad%2C%20x_grid)%3A%0A%20%20%20%20%23%20Verify%20that%20the%20KDE%20integrates%20to%20approximately%201%0A%20%20%20%20from%20scipy.interpolate%20import%20interp1d%0A%0A%20%20%20%20%23%20Create%20interpolation%20function%20for%20numerical%20integration%0A%20%20%20%20_kde_interp%20%3D%20interp1d(x_grid%2C%20kde_estimate%2C%20kind%3D'cubic'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bounds_error%3DFalse%2C%20fill_value%3D0)%0A%0A%20%20%20%20%23%20Numerical%20integration%0A%20%20%20%20_x_min_int%2C%20_x_max_int%20%3D%20np.min(x_grid)%2C%20np.max(x_grid)%0A%20%20%20%20_integral_result%2C%20_integral_error%20%3D%20quad(_kde_interp%2C%20_x_min_int%2C%20_x_max_int)%0A%0A%20%20%20%20%23%20Create%20area%20verification%20plot%0A%20%20%20%20area_fig%20%3D%20go.Figure()%0A%0A%20%20%20%20%23%20Plot%20the%20KDE%20with%20filled%20area%0A%20%20%20%20area_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20x%3Dx_grid%2C%0A%20%20%20%20%20%20%20%20y%3Dkde_estimate%2C%0A%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20line%3Ddict(width%3D3%2C%20color%3D'darkred')%2C%0A%20%20%20%20%20%20%20%20fill%3D'tozeroy'%2C%0A%20%20%20%20%20%20%20%20fillcolor%3D'rgba(139%2C0%2C0%2C0.3)'%2C%0A%20%20%20%20%20%20%20%20name%3D'KDE%20Estimate'%2C%0A%20%20%20%20%20%20%20%20hovertemplate%3D'x%3A%20%25%7Bx%3A.2f%7D%3Cbr%3EDensity%3A%20%25%7By%3A.3f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20))%0A%0A%20%20%20%20%23%20Add%20horizontal%20line%20at%20y%3D0%0A%20%20%20%20area_fig.add_hline(y%3D0%2C%20line%3Ddict(color%3D%22black%22%2C%20width%3D1))%0A%0A%20%20%20%20area_fig.update_layout(%0A%20%20%20%20%20%20%20%20title%3Df'KDE%20Area%20Verification%20(%E2%88%ABf(x)dx%20%E2%89%88%20%7B_integral_result%3A.4f%7D)'%2C%0A%20%20%20%20%20%20%20%20xaxis_title%3D'x'%2C%0A%20%20%20%20%20%20%20%20yaxis_title%3D'Density%20f(x)'%2C%0A%20%20%20%20%20%20%20%20width%3D800%2C%0A%20%20%20%20%20%20%20%20height%3D500%2C%0A%20%20%20%20%20%20%20%20showlegend%3DTrue%2C%0A%20%20%20%20%20%20%20%20annotations%3D%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3D0.5%2C%20y%3D0.95%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xref%3D%22paper%22%2C%20yref%3D%22paper%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%3Df%22Total%20Area%20%3D%20%7B_integral_result%3A.4f%7D%3Cbr%3E(Should%20%E2%89%88%201.000)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20showarrow%3DFalse%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bgcolor%3D%22rgba(255%2C255%2C255%2C0.8)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bordercolor%3D%22black%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20borderwidth%3D1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20font%3Ddict(size%3D14)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Bandwidth%20Effects%3A%20The%20Bias-Variance%20Trade-off%0A%0A%20%20%20%20%20%20%20%20The%20bandwidth%20parameter%20%24h%24%20controls%20the%20smoothness%20of%20the%20KDE.%20Let's%20explore%20how%20different%20bandwidth%20values%20affect%20the%20density%20estimate.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(go%2C%20kernel_functions%2C%20make_subplots%2C%20np%2C%20sample_data)%3A%0A%20%20%20%20%23%20Compare%20different%20bandwidth%20values%0A%20%20%20%20bandwidth_values%20%3D%20%5B0.3%2C%200.8%2C%202.0%5D%0A%20%20%20%20bandwidth_labels%20%3D%20%5B%22Narrow%20(h%3D0.3)%22%2C%20%22Medium%20(h%3D0.8)%22%2C%20%22Wide%20(h%3D2.0)%22%5D%0A%0A%20%20%20%20%23%20Create%20subplot%20figure%0A%20%20%20%20bandwidth_comparison_fig%20%3D%20make_subplots(%0A%20%20%20%20%20%20%20%20rows%3D1%2C%20cols%3D3%2C%0A%20%20%20%20%20%20%20%20subplot_titles%3Dbandwidth_labels%2C%0A%20%20%20%20%20%20%20%20horizontal_spacing%3D0.08%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Use%20Gaussian%20kernel%20for%20comparison%0A%20%20%20%20_gaussian_func%20%3D%20kernel_functions%5B'Gaussian'%5D%5B'func'%5D%0A%0A%20%20%20%20%23%20Calculate%20range%0A%20%20%20%20_x_min%2C%20_x_max%20%3D%20np.min(sample_data)%20-%203%2C%20np.max(sample_data)%20%2B%203%0A%20%20%20%20_x_grid%20%3D%20np.linspace(_x_min%2C%20_x_max%2C%20300)%0A%0A%20%20%20%20_colors%20%3D%20%5B'blue'%2C%20'green'%2C%20'red'%5D%0A%0A%20%20%20%20for%20_i%2C%20(_h_val%2C%20_h_label)%20in%20enumerate(zip(bandwidth_values%2C%20bandwidth_labels))%3A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20KDE%20for%20this%20bandwidth%0A%20%20%20%20%20%20%20%20_kde_vals%20%3D%20np.zeros_like(_x_grid)%0A%20%20%20%20%20%20%20%20for%20_xi%20in%20sample_data%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20_kde_vals%20%2B%3D%20_gaussian_func((_x_grid%20-%20_xi)%20%2F%20_h_val)%0A%20%20%20%20%20%20%20%20_kde_vals%20%3D%20_kde_vals%20%2F%20(len(sample_data)%20*%20_h_val)%0A%0A%20%20%20%20%20%20%20%20%23%20Add%20data%20points%20(rug%20plot)%0A%20%20%20%20%20%20%20%20bandwidth_comparison_fig.add_trace(%0A%20%20%20%20%20%20%20%20%20%20%20%20go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Dsample_data%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3Dnp.zeros(len(sample_data))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'black'%2C%20size%3D6%2C%20symbol%3D'line-ns'%2C%20line%3Ddict(width%3D2))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%3D'Data'%20if%20_i%20%3D%3D%200%20else%20''%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20showlegend%3D(_i%20%3D%3D%200)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D_i%2B1%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Add%20KDE%20curve%0A%20%20%20%20%20%20%20%20bandwidth_comparison_fig.add_trace(%0A%20%20%20%20%20%20%20%20%20%20%20%20go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3D_x_grid%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3D_kde_vals%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(width%3D3%2C%20color%3D_colors%5B_i%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%3D_h_label%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3Df'h%3D%7B_h_val%7D%3Cbr%3Ex%3A%20%25%7B%7Bx%3A.2f%7D%7D%3Cbr%3EDensity%3A%20%25%7B%7By%3A.3f%7D%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D_i%2B1%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20bandwidth_comparison_fig.update_layout(%0A%20%20%20%20%20%20%20%20title%3D'Bandwidth%20Effect%20on%20KDE%3A%20Bias-Variance%20Trade-off'%2C%0A%20%20%20%20%20%20%20%20height%3D500%2C%0A%20%20%20%20%20%20%20%20width%3D1200%2C%0A%20%20%20%20%20%20%20%20showlegend%3DTrue%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Update%20axis%20labels%0A%20%20%20%20for%20_i%20in%20range(3)%3A%0A%20%20%20%20%20%20%20%20bandwidth_comparison_fig.update_xaxes(title_text%3D%22x%22%2C%20row%3D1%2C%20col%3D_i%2B1)%0A%20%20%20%20%20%20%20%20bandwidth_comparison_fig.update_yaxes(title_text%3D%22Density%22%2C%20row%3D1%2C%20col%3D_i%2B1)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Kernel%20Comparison%20on%20the%20Same%20Dataset%0A%0A%20%20%20%20%20%20%20%20Different%20kernel%20functions%20produce%20slightly%20different%20density%20estimates.%20Let's%20compare%20them%20using%20the%20same%20bandwidth%20to%20see%20their%20effects.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(bandwidth_slider%2C%20go%2C%20kernel_functions%2C%20np%2C%20sample_data)%3A%0A%20%20%20%20%23%20Compare%20different%20kernels%20with%20the%20same%20bandwidth%0A%20%20%20%20kernel_comparison_data_fig%20%3D%20go.Figure()%0A%0A%20%20%20%20%23%20Use%20current%20bandwidth%20from%20slider%0A%20%20%20%20_current_bandwidth%20%3D%20bandwidth_slider.value%0A%20%20%20%20_x_range%20%3D%20np.linspace(np.min(sample_data)%20-%203%2C%20np.max(sample_data)%20%2B%203%2C%20400)%0A%0A%20%20%20%20%23%20Colors%20for%20different%20kernels%0A%20%20%20%20_kernel_colors%20%3D%20%7B'Gaussian'%3A%20'blue'%2C%20'Epanechnikov'%3A%20'red'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Triangular'%3A%20'green'%2C%20'Uniform'%3A%20'orange'%7D%0A%0A%20%20%20%20%23%20Add%20data%20points%20first%0A%20%20%20%20kernel_comparison_data_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20x%3Dsample_data%2C%0A%20%20%20%20%20%20%20%20y%3Dnp.zeros(len(sample_data))%2C%0A%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'black'%2C%20size%3D8%2C%20symbol%3D'line-ns'%2C%20line%3Ddict(width%3D3))%2C%0A%20%20%20%20%20%20%20%20name%3D'Sample%20Data'%2C%0A%20%20%20%20%20%20%20%20hovertemplate%3D'Data%3A%20%25%7Bx%3A.2f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20))%0A%0A%20%20%20%20%23%20Calculate%20and%20plot%20KDE%20for%20each%20kernel%0A%20%20%20%20for%20_kernel_name%2C%20_kernel_info%20in%20kernel_functions.items()%3A%0A%20%20%20%20%20%20%20%20_kernel_func%20%3D%20_kernel_info%5B'func'%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20KDE%0A%20%20%20%20%20%20%20%20_kde_vals%20%3D%20np.zeros_like(_x_range)%0A%20%20%20%20%20%20%20%20for%20_xi%20in%20sample_data%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20_kde_vals%20%2B%3D%20_kernel_func((_x_range%20-%20_xi)%20%2F%20_current_bandwidth)%0A%20%20%20%20%20%20%20%20_kde_vals%20%3D%20_kde_vals%20%2F%20(len(sample_data)%20*%20_current_bandwidth)%0A%0A%20%20%20%20%20%20%20%20%23%20Add%20to%20plot%0A%20%20%20%20%20%20%20%20kernel_comparison_data_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3D_x_range%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3D_kde_vals%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(width%3D3%2C%20color%3D_kernel_colors%5B_kernel_name%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3Df'%7B_kernel_name%7D%20Kernel'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3Df'%7B_kernel_name%7D%3Cbr%3Ex%3A%20%25%7B%7Bx%3A.2f%7D%7D%3Cbr%3EDensity%3A%20%25%7B%7By%3A.3f%7D%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20))%0A%0A%20%20%20%20kernel_comparison_data_fig.update_layout(%0A%20%20%20%20%20%20%20%20title%3Df'Kernel%20Function%20Comparison%20(h%3D%7B_current_bandwidth%3A.1f%7D)'%2C%0A%20%20%20%20%20%20%20%20xaxis_title%3D'x'%2C%0A%20%20%20%20%20%20%20%20yaxis_title%3D'Density'%2C%0A%20%20%20%20%20%20%20%20width%3D900%2C%0A%20%20%20%20%20%20%20%20height%3D600%2C%0A%20%20%20%20%20%20%20%20showlegend%3DTrue%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Interactive%20Kernel%20Exploration%20at%20a%20Specific%20Point%0A%0A%20%20%20%20%20%20%20%20Select%20a%20point%20to%20see%20how%20each%20data%20point%20contributes%20to%20the%20density%20estimate%20at%20that%20location.%20This%20helps%20understand%20the%20%22local%20averaging%22%20nature%20of%20KDE.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Query%20point%20selector%20for%20detailed%20analysis%0A%20%20%20%20query_point_slider%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D-4%2C%20stop%3D4%2C%20step%3D0.1%2C%20value%3D0.0%2C%0A%20%20%20%20%20%20%20%20label%3D'Query%20Point%20for%20Detailed%20Analysis%3A'%0A%20%20%20%20)%0A%0A%20%20%20%20show_kernel_weights%20%3D%20mo.ui.checkbox(%0A%20%20%20%20%20%20%20%20value%3DTrue%2C%0A%20%20%20%20%20%20%20%20label%3D'Show%20Individual%20Kernel%20Weights'%0A%20%20%20%20)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Detailed%20Analysis%20Controls%3A**%0A%0A%20%20%20%20%7Bquery_point_slider%7D%0A%20%20%20%20%7Bshow_kernel_weights%7D%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%20query_point_slider%2C%20show_kernel_weights%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20bandwidth_slider%2C%0A%20%20%20%20go%2C%0A%20%20%20%20kernel_functions%2C%0A%20%20%20%20kernel_selector%2C%0A%20%20%20%20np%2C%0A%20%20%20%20query_point_slider%2C%0A%20%20%20%20sample_data%2C%0A%20%20%20%20show_kernel_weights%2C%0A)%3A%0A%20%20%20%20%23%20Detailed%20analysis%20at%20query%20point%0A%20%20%20%20query_x%20%3D%20query_point_slider.value%0A%20%20%20%20analysis_bandwidth%20%3D%20bandwidth_slider.value%0A%20%20%20%20analysis_kernel%20%3D%20kernel_functions%5Bkernel_selector.value%5D%5B'func'%5D%0A%0A%20%20%20%20%23%20Calculate%20contributions%20from%20each%20data%20point%0A%20%20%20%20contributions_data%20%3D%20%5B%5D%0A%20%20%20%20for%20_i%2C%20_xi%20in%20enumerate(sample_data)%3A%0A%20%20%20%20%20%20%20%20_u%20%3D%20(query_x%20-%20_xi)%20%2F%20analysis_bandwidth%0A%20%20%20%20%20%20%20%20_kernel_weight%20%3D%20analysis_kernel(_u)%0A%20%20%20%20%20%20%20%20contributions_data.append(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'index'%3A%20_i%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'data_point'%3A%20_xi%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'distance'%3A%20abs(query_x%20-%20_xi)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'standardised_distance'%3A%20_u%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'kernel_weight'%3A%20_kernel_weight%0A%20%20%20%20%20%20%20%20%7D)%0A%0A%20%20%20%20%23%20Sort%20by%20kernel%20weight%20(descending)%0A%20%20%20%20contributions_data.sort(key%3Dlambda%20x%3A%20x%5B'kernel_weight'%5D%2C%20reverse%3DTrue)%0A%0A%20%20%20%20%23%20Create%20detailed%20analysis%20figure%0A%20%20%20%20analysis_fig%20%3D%20go.Figure()%0A%0A%20%20%20%20%23%20Add%20all%20data%20points%0A%20%20%20%20analysis_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20x%3Dsample_data%2C%0A%20%20%20%20%20%20%20%20y%3Dnp.zeros(len(sample_data))%2C%0A%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'lightgray'%2C%20size%3D8%2C%20symbol%3D'line-ns'%2C%20line%3Ddict(width%3D2))%2C%0A%20%20%20%20%20%20%20%20name%3D'All%20Data%20Points'%2C%0A%20%20%20%20%20%20%20%20hovertemplate%3D'Data%3A%20%25%7Bx%3A.2f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20))%0A%0A%20%20%20%20if%20show_kernel_weights.value%3A%0A%20%20%20%20%20%20%20%20%23%20Show%20top%20contributors%20with%20proportional%20marker%20sizes%0A%20%20%20%20%20%20%20%20_max_weight%20%3D%20max(%5Bc%5B'kernel_weight'%5D%20for%20c%20in%20contributions_data%5D)%0A%0A%20%20%20%20%20%20%20%20for%20contrib%20in%20contributions_data%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20contrib%5B'kernel_weight'%5D%20%3E%200.001%3A%20%20%23%20Only%20show%20significant%20contributors%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_size%20%3D%208%20%2B%20(contrib%5B'kernel_weight'%5D%20%2F%20_max_weight)%20*%2020%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_color_intensity%20%3D%20contrib%5B'kernel_weight'%5D%20%2F%20_max_weight%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20analysis_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3D%5Bcontrib%5B'data_point'%5D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3D%5B0%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3Df'rgba(255%2C0%2C0%2C%7B_color_intensity%7D)'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%3D_size%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20symbol%3D'circle'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(color%3D'red'%2C%20width%3D1)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%3Df%22Point%20%7Bcontrib%5B'index'%5D%7D%22%20if%20contrib%20%3D%3D%20contributions_data%5B0%5D%20else%20''%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20showlegend%3D(contrib%20%3D%3D%20contributions_data%5B0%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hovertemplate%3Df'Data%3A%20%7Bcontrib%5B%22data_point%22%5D%3A.2f%7D%3Cbr%3E'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f'Distance%3A%20%7Bcontrib%5B%22distance%22%5D%3A.2f%7D%3Cbr%3E'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f'Weight%3A%20%7Bcontrib%5B%22kernel_weight%22%5D%3A.3f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20))%0A%0A%20%20%20%20%23%20Highlight%20query%20point%0A%20%20%20%20analysis_fig.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20x%3D%5Bquery_x%5D%2C%0A%20%20%20%20%20%20%20%20y%3D%5B0%5D%2C%0A%20%20%20%20%20%20%20%20mode%3D'markers'%2C%0A%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'blue'%2C%20size%3D15%2C%20symbol%3D'star')%2C%0A%20%20%20%20%20%20%20%20name%3Df'Query%20Point%20(x%3D%7Bquery_x%3A.1f%7D)'%2C%0A%20%20%20%20%20%20%20%20hovertemplate%3Df'Query%20Point%3A%20%7Bquery_x%3A.1f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20))%0A%0A%20%20%20%20%23%20Add%20vertical%20line%20at%20query%20point%0A%20%20%20%20analysis_fig.add_vline(%0A%20%20%20%20%20%20%20%20x%3Dquery_x%2C%0A%20%20%20%20%20%20%20%20line%3Ddict(color%3D%22blue%22%2C%20dash%3D%22dash%22%2C%20width%3D2)%2C%0A%20%20%20%20%20%20%20%20opacity%3D0.7%0A%20%20%20%20)%0A%0A%20%20%20%20analysis_fig.update_layout(%0A%20%20%20%20%20%20%20%20title%3Df'Kernel%20Contributions%20at%20x%20%3D%20%7Bquery_x%3A.1f%7D'%2C%0A%20%20%20%20%20%20%20%20xaxis_title%3D'x'%2C%0A%20%20%20%20%20%20%20%20yaxis_title%3D''%2C%0A%20%20%20%20%20%20%20%20yaxis%3Ddict(showticklabels%3DFalse%2C%20range%3D%5B-0.5%2C%200.5%5D)%2C%0A%20%20%20%20%20%20%20%20width%3D900%2C%0A%20%20%20%20%20%20%20%20height%3D400%2C%0A%20%20%20%20%20%20%20%20showlegend%3DTrue%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Calculate%20final%20KDE%20value%20at%20query%20point%0A%20%20%20%20_total_contribution%20%3D%20sum(%5Bc%5B'kernel_weight'%5D%20for%20c%20in%20contributions_data%5D)%0A%20%20%20%20_final_kde_value%20%3D%20_total_contribution%20%2F%20(len(sample_data)%20*%20analysis_bandwidth)%0A%20%20%20%20return%20analysis_bandwidth%2C%20contributions_data%2C%20query_x%0A%0A%0A%40app.cell%0Adef%20_(analysis_bandwidth%2C%20contributions_data%2C%20mo%2C%20query_x%2C%20sample_data)%3A%0A%20%20%20%20%23%20Display%20contribution%20table%0A%20%20%20%20_top_contributors%20%3D%20contributions_data%5B%3A8%5D%20%20%23%20Show%20top%208%20contributors%0A%20%20%20%20_total_weight%20%3D%20sum(%5Bc%5B'kernel_weight'%5D%20for%20c%20in%20contributions_data%5D)%0A%20%20%20%20_final_value%20%3D%20_total_weight%20%2F%20(len(sample_data)%20*%20analysis_bandwidth)%0A%0A%20%20%20%20%23%20Create%20contribution%20table%20as%20markdown%20string%0A%20%20%20%20_table_rows%20%3D%20%22%22.join(%5B%0A%20%20%20%20%20%20%20%20f%22%7C%20%7Bc%5B'data_point'%5D%3A.2f%7D%20%7C%20%7Bc%5B'distance'%5D%3A.2f%7D%20%7C%20%7Bc%5B'standardised_distance'%5D%3A.2f%7D%20%7C%20%7Bc%5B'kernel_weight'%5D%3A.4f%7D%20%7C%5Cn%22%0A%20%20%20%20%20%20%20%20for%20c%20in%20_top_contributors%0A%20%20%20%20%5D)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20%23%23%20Contribution%20Analysis%20at%20x%20%3D%20%7Bquery_x%3A.2f%7D%0A%0A%20%20%20%20**Top%20Contributors%20(by%20kernel%20weight)%3A**%0A%0A%20%20%20%20%7C%20Data%20Point%20%7C%20Distance%20%7C%20Standardised%20u%20%7C%20Kernel%20Weight%20%7C%0A%20%20%20%20%7C------------%7C----------%7C----------------%7C---------------%7C%0A%20%20%20%20%7B_table_rows%7D%0A%0A%20%20%20%20**Final%20Calculation%3A**%0A%0A%20%20%20%20-%20Sum%20of%20all%20kernel%20weights%3A%20%7B_total_weight%3A.4f%7D%0A%20%20%20%20-%20Normalisation%20factor%20(n%C3%97h)%3A%20%7Blen(sample_data)%7D%20%C3%97%20%7Banalysis_bandwidth%3A.1f%7D%20%3D%20%7Blen(sample_data)%20*%20analysis_bandwidth%3A.1f%7D%0A%20%20%20%20-%20**KDE%20value%20at%20x%3D%7Bquery_x%3A.2f%7D%3A%20%7B_final_value%3A.4f%7D**%0A%0A%20%20%20%20Notice%20how%20data%20points%20closer%20to%20the%20query%20point%20contribute%20more%20weight%20to%20the%20final%20density%20estimate.%20This%20demonstrates%20the%20%22local%20averaging%22%20principle%20of%20KDE.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Key%20Insights%20and%20Educational%20Summary%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Understanding%20KDE%20Through%20Interactive%20Exploration%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%8E%AF%20Core%20Concept%3A**%0A%20%20%20%20%20%20%20%20KDE%20builds%20smooth%20density%20estimates%20by%3A%0A%0A%20%20%20%20%20%20%20%201.%20Placing%20a%20%22bump%22%20(kernel)%20at%20each%20data%20point%0A%20%20%20%20%20%20%20%202.%20Summing%20all%20bumps%20together%0A%20%20%20%20%20%20%20%203.%20Normalising%20by%20dividing%20by%20%24nh%24%20to%20ensure%20total%20area%20%3D%201%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%93%8A%20Mathematical%20Intuition%3A**%0A%0A%20%20%20%20%20%20%20%20-%20**Individual%20kernels**%3A%20Each%20data%20point%20contributes%20a%20smooth%20bump%0A%20%20%20%20%20%20%20%20-%20**Summing%20bumps**%3A%20Overlapping%20kernels%20create%20peaks%20where%20data%20clusters%0A%20%20%20%20%20%20%20%20-%20**Normalisation**%3A%20Division%20by%20%24nh%24%20makes%20it%20a%20valid%20probability%20density%0A%20%20%20%20%20%20%20%20-%20**Local%20averaging**%3A%20Points%20closer%20to%20query%20location%20have%20higher%20influence%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Parameter%20Effects%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%94%A7%20Bandwidth%20(h)%20-%20The%20Smoothness%20Controller%3A**%0A%0A%20%20%20%20%20%20%20%20-%20**Small%20h**%3A%20Wiggly%2C%20follows%20data%20closely%20(low%20bias%2C%20high%20variance)%0A%20%20%20%20%20%20%20%20-%20**Large%20h**%3A%20Smooth%2C%20may%20miss%20features%20(high%20bias%2C%20low%20variance)%0A%20%20%20%20%20%20%20%20-%20**Optimal%20h**%3A%20Balances%20detail%20and%20smoothness%0A%0A%20%20%20%20%20%20%20%20**%F0%9F%93%90%20Kernel%20Choice%20-%20The%20Bump%20Shape%3A**%0A%0A%20%20%20%20%20%20%20%20-%20**Gaussian**%3A%20Smooth%2C%20infinite%20support%2C%20most%20popular%0A%20%20%20%20%20%20%20%20-%20**Epanechnikov**%3A%20Finite%20support%2C%20theoretically%20optimal%0A%20%20%20%20%20%20%20%20-%20**Triangular**%3A%20Simple%2C%20finite%20support%0A%20%20%20%20%20%20%20%20-%20**Uniform**%3A%20Rectangular%20bumps%20(equivalent%20to%20histogram)%0A%20%20%20%20%20%20%20%20-%20**Impact**%3A%20Kernel%20choice%20matters%20less%20than%20bandwidth%20selection%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Practical%20Applications%0A%0A%20%20%20%20%20%20%20%20**%E2%9C%85%20When%20to%20Use%20KDE%3A**%0A%0A%20%20%20%20%20%20%20%20-%20Exploratory%20data%20analysis%20to%20understand%20data%20shape%0A%20%20%20%20%20%20%20%20-%20No%20assumptions%20about%20underlying%20distribution%0A%20%20%20%20%20%20%20%20-%20Need%20smooth%2C%20continuous%20density%20estimates%0A%20%20%20%20%20%20%20%20-%20Sufficient%20sample%20size%20available%0A%0A%20%20%20%20%20%20%20%20**%E2%9A%A0%EF%B8%8F%20Limitations%20to%20Consider%3A**%0A%0A%20%20%20%20%20%20%20%20-%20Requires%20more%20data%20than%20parametric%20methods%0A%20%20%20%20%20%20%20%20-%20Computationally%20intensive%20for%20large%20datasets%0A%20%20%20%20%20%20%20%20-%20Boundary%20effects%20near%20data%20edges%0A%20%20%20%20%20%20%20%20-%20Curse%20of%20dimensionality%20in%20high%20dimensions%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Interactive%20Learning%20Benefits%0A%0A%20%20%20%20%20%20%20%20Through%20this%20notebook%2C%20you've%20experienced%3A%0A%0A%20%20%20%20%20%20%20%20-%20**Visual%20construction**%20of%20density%20estimates%20from%20individual%20components%0A%20%20%20%20%20%20%20%20-%20**Parameter%20sensitivity**%20through%20real-time%20adjustments%0A%20%20%20%20%20%20%20%20-%20**Mathematical%20transparency**%20with%20step-by-step%20calculations%0A%20%20%20%20%20%20%20%20-%20**Comparative%20analysis**%20across%20different%20settings%0A%0A%20%20%20%20%20%20%20%20This%20hands-on%20approach%20builds%20intuition%20that's%20difficult%20to%20achieve%20through%20equations%20alone!%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "notebook.py",
            "mode": "read",
            "version": "0.16.2",
            "serverToken": "unused",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "display": {"cell_output": "above", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": false},
            "notebook": null,
            "session": null,
            "runtimeConfig": null,
        };
    </script>
  </body>
</html>
